<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to Univariate Discrete Population Synthesis • lemur.pack</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Introduction to Univariate Discrete Population Synthesis">
<meta property="og:description" content="lemur.pack">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">lemur.pack</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../articles/lemur-pack.html">Get started</a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/articles/discreteIntro.html">Intro - Univariate Discrete</a>
    </li>
    <li>
      <a href="../../articles/articles/continuousIntro.html">Intro - Univariate Continuous</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/test.html">Testing</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ctgrubb/lemur.pack/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="discreteIntro_files/jquery-1.11.3/jquery.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1">
<link href="discreteIntro_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet">
<script src="discreteIntro_files/bootstrap-3.3.5/js/bootstrap.min.js"></script><script src="discreteIntro_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script><script src="discreteIntro_files/bootstrap-3.3.5/shim/respond.min.js"></script><style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="discreteIntro_files/jqueryui-1.11.4/jquery-ui.min.js"></script><link href="discreteIntro_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet">
<script src="discreteIntro_files/tocify-1.9.1/jquery.tocify.js"></script><script src="discreteIntro_files/navigation-1.1/tabsets.js"></script><script src="discreteIntro_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to Univariate Discrete Population Synthesis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ctgrubb/lemur.pack/blob/master/vignettes/articles/discreteIntro.Rmd"><code>vignettes/articles/discreteIntro.Rmd</code></a></small>
      <div class="hidden name"><code>discreteIntro.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ctgrubb.github.io/lemur.pack">lemur.pack</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/twolodzko/extraDistr">extraDistr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/">kableExtra</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">proftools</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span></code></pre></div>
<p>This vignette explains population synthesis for the discrete cases; in particular we will talk about the situations where subjects are described by the following:</p>
<ul>
<li>(Case 1) A single binary <span class="math inline">\(\mathbf{\{0, 1\}}\)</span> variable</li>
<li>(Case 2) A single ternary (or higher) <span class="math inline">\(\mathbf{\{0, 1, \dots, c\}}\)</span> variable</li>
</ul>
<p>In both cases, the only piece of information used to inform what the population looks like is a simple random sample of size <span class="math inline">\(n\)</span>, which can be thought of as an <span class="math inline">\(n\)</span>-vector <span class="math inline">\(\mathbf{x}\)</span>, which is a realization of <span class="math inline">\(\mathbf{X}\)</span>. Our goal is to synthesize numerous realizations of the population <span class="math inline">\(\mathbf{Y}\)</span> with size <span class="math inline">\(N\)</span>. A realization of the population is denoted <span class="math inline">\(\mathbf{y}\)</span>, and we will assume that <span class="math inline">\(N\)</span> is known.</p>
<div id="theory" class="section level1">
<h1 class="hasAnchor">
<a href="#theory" class="anchor"></a><span class="header-section-number">1</span> Theory</h1>
<p>For a population <span class="math inline">\(\mathbf{Y}\)</span>, sample <span class="math inline">\(\mathbf{X}\)</span>, and parameter set <span class="math inline">\(\theta\)</span>, we can use Bayes’ theorem to get the distribution for <span class="math inline">\(\mathbf{Y}\)</span>, conditioned on our observed sample, <span class="math inline">\(\mathbf{x}\)</span>.</p>
<p><span class="math display">\[\begin{align*}
  f(\theta, \mathbf{Y} = \mathbf{y}| \mathbf{X} = \mathbf{x}) &amp;= \frac{ f(\mathbf{X} = \mathbf{x} | \theta, \mathbf{Y} = \mathbf{y}) f(\theta, \mathbf{Y} = \mathbf{y}) }{ f(\mathbf{X} = \mathbf{x}) } \\
    &amp;\propto f(\mathbf{X} = \mathbf{x} | \theta) f(\mathbf{Y} = \mathbf{y} | \theta) \pi(\theta)
\end{align*}\]</span></p>
<p>For the univariate discrete case, this is actually quite simple, however we do have a couple decisions to make:</p>
<ul>
<li>What is the distribution of <span class="math inline">\(f(\mathbf{X} = \mathbf{x} | \theta)\)</span>?</li>
<li>What prior <span class="math inline">\(\pi(\theta)\)</span> should we use?</li>
</ul>
<p>The first question boils down to whether we believe our observed sample came from sampling with or without replacement. Usually, populations of people are sampled without replacement, in which case the proper likelihood would be <span class="math inline">\(Hypergeometric\)</span> or its multivariate extension, the <span class="math inline">\(Multivariate\ Hypergeometric\)</span>. You may be confused by the word multivariate here; oddly, the name of the extension of the <span class="math inline">\(Hypergeometric\)</span> distribution to more than two categories is named the <span class="math inline">\(Multivariate\ Hypergeometric\)</span>, even though it is still technically univariate.</p>
<p>If the population is sufficiently large, or we know it was sampled with replacement, we may choose to use a <span class="math inline">\(Binomial\)</span> or <span class="math inline">\(Multinomial\)</span> likelihood, instead. Sampling with replacement results in independent samples; sampling without replacement yields samples that are not independent. This document will not go into detail about the difference between these two, but you should be aware that extreme samples (e.g., a sample very close to being all <span class="math inline">\(1\)</span>’s or all <span class="math inline">\(0\)</span>’s) are more likely when sampling with replacement. In essence, this results in our distribution over <span class="math inline">\(K\)</span> (the number of successes in the population) having fatter tails when we use the <span class="math inline">\(Binomial\)</span> likelihood versus the <span class="math inline">\(Hypergeometric\)</span> likelihood. The table below summarizes which distribution we will use for our likelihood.</p>
<table class="table table">
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Independence/Replacement?
</div>
</th>
</tr>
<tr>
<th style="text-align:center;">
Case
</th>
<th style="text-align:center;">
Yes
</th>
<th style="text-align:center;">
No
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
Binomial
</td>
<td style="text-align:center;">
Hypergeometric
</td>
</tr>
<tr>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
Multinomial
</td>
<td style="text-align:center;">
MV Hypergeometric
</td>
</tr>
</tbody>
</table>
<p>Of course, the choice of prior <span class="math inline">\(\pi(\theta)\)</span> depends on the likelihood we choose. This document will focus on the likely choice; if we are using a <span class="math inline">\(Binomial\)</span> or <span class="math inline">\(Multinomial\)</span> likelihood, we probably will use some form of the conjugate prior, <span class="math inline">\(Beta(a, b)\)</span> or <span class="math inline">\(Dirichlet(\alpha)\)</span>, respectively. In particular, the most common choices are <span class="math inline">\(Beta(1, 1)\)</span>, the continuous uniform, and <span class="math inline">\(Beta(1/2, 1/2)\)</span>, the Jeffreys prior, for the <span class="math inline">\(Binomial\)</span> case. Likewise, these have direct extensions in <span class="math inline">\(Dirichlet(1, \dots, 1)\)</span>, and <span class="math inline">\(Dirichlet(1/2, \dots, 1/2)\)</span> for the <span class="math inline">\(Multinomial\)</span> case.</p>
<p>As we will see the multi-category extensions of these distributions does not change much. Thus, we will start with the binary versions and then discuss what changes when we switch to having three or more categories.</p>
<div id="binomial" class="section level2">
<h2 class="hasAnchor">
<a href="#binomial" class="anchor"></a><span class="header-section-number">1.1</span> Binomial</h2>
<p>Things are very simple if we choose to use a <span class="math inline">\(Binomial\)</span> likelihood. If we apply the above theory to the binomial, we get</p>
<p><span class="math display">\[\begin{align*}
  f(\mathbf{Y} = \mathbf{y}, \mathbf{p} | \mathbf{X} = \mathbf{x}) &amp;= \frac{ f(\mathbf{X} = \mathbf{x} | \mathbf{Y} = \mathbf{y}, p) f(\mathbf{Y} = \mathbf{y}, p) }{ f(\mathbf{X} = \mathbf{x}) } \\
                                 &amp;\propto f(\mathbf{X} = \mathbf{x} | p ) f(\mathbf{Y} = \mathbf{y} | p) \pi(p) \\
                                 &amp;\propto \pi(p | \mathbf{X} = \mathbf{x}) f(\mathbf{Y} = \mathbf{y} | p)
\end{align*}\]</span></p>
<p>Using the conjugate <span class="math inline">\(Beta(a, b)\)</span> prior gives us the canonical <span class="math inline">\(Beta(K+a, N-K+b)\)</span> posterior. As we will see, it is fairly straightforward to create an MCMC algorithm to jitter <span class="math inline">\(Y\)</span> and accept or reject using this posterior.</p>
</div>
<div id="multinomial" class="section level2">
<h2 class="hasAnchor">
<a href="#multinomial" class="anchor"></a><span class="header-section-number">1.2</span> Multinomial</h2>
<p>If we are instead using the <span class="math inline">\(Multinomial\)</span> likelihood, there is not much that changes. Notably, <span class="math inline">\(p\)</span> and <span class="math inline">\(K\)</span> are now vectors of length <span class="math inline">\(c\)</span>, where <span class="math inline">\(c\)</span> is the number of categories, and our prior will likely be <span class="math inline">\(Dirichlet(\alpha)\)</span>, the conjugate prior for the <span class="math inline">\(Multinomial\)</span> distribution. The new posterior with the conjugate prior is <span class="math inline">\(Dirichlet(K_1 + \alpha_1, \dots, K_c + \alpha_c)\)</span>.</p>
</div>
<div id="hypergeometric" class="section level2">
<h2 class="hasAnchor">
<a href="#hypergeometric" class="anchor"></a><span class="header-section-number">1.3</span> Hypergeometric</h2>
<p>The common parameterization of the <span class="math inline">\(Hypergeometric\)</span> distribution can make this rather confusing. Instead of working with that, lets make our own.</p>
<p>Let <span class="math inline">\(f(\mathbf{Y}, K, \mathbf{X}, J)\)</span> denote the <span class="math inline">\(Hypergeometric\)</span> probability mass function, where:</p>
<ul>
<li>
<span class="math inline">\(\mathbf{Y}\)</span> is the population (i.e., the vector of <span class="math inline">\(\{0, 1\}\)</span> with length <span class="math inline">\(N\)</span>)
<ul>
<li>
<span class="math inline">\(K\)</span> is the number of successes (<span class="math inline">\(1\)</span>’s) in the population <span class="math inline">\(\mathbf{Y}\)</span>
</li>
<li>
<span class="math inline">\(\mathbf{X}\)</span> is the sample, with length <span class="math inline">\(n\)</span>
</li>
<li>
<span class="math inline">\(J\)</span> is the number of successes (<span class="math inline">\(1\)</span>’s) in the sample <span class="math inline">\(\mathbf{X}\)</span>
</li>
</ul>
</li>
</ul>
<p>Now, we can apply the above theory to our specific distribution, and we get</p>
<p><span class="math display">\[\begin{align*}
  f(\mathbf{Y} = \mathbf{y}, \mathbf{K} | \mathbf{X} = \mathbf{x}, J) &amp;= \frac{ f(\mathbf{X} = \mathbf{x}, J | \mathbf{Y} = \mathbf{y}, K) f(\mathbf{Y} = \mathbf{y}, K) }{ f(\mathbf{X} = \mathbf{x}, J) } \\
                                 &amp;\propto f(\mathbf{X} = \mathbf{x}, J | K ) f(\mathbf{Y} = \mathbf{y} | K) \pi(K) \\
                                 &amp;\propto \pi(K | \mathbf{X} = \mathbf{x}, J) f(\mathbf{Y} = \mathbf{y} | K)
\end{align*}\]</span></p>
<p>We also need to choose <span class="math inline">\(\pi(K)\)</span>, the prior on the number of successes in the population. Above, if we were working with <span class="math inline">\(p\)</span> from the <span class="math inline">\(Binomial\)</span> distribution, we would likely want to use some version of the conjugate prior, <span class="math inline">\(Beta(a, b)\)</span>.</p>
<p>From Jeffreys (1946, 1961), the induced prior on <span class="math inline">\(K\)</span> can be found by constructing a hierarchical prior of the form</p>
<p><span class="math display">\[ Binom(K | p) Beta(p | a, b) \]</span></p>
<p>and then marginalizing to find <span class="math inline">\(\pi(K)\)</span>. Thus,</p>
<p><span class="math display">\[\begin{align*}
\pi(K) &amp;= \int_{0}^{1} {N \choose K} p^K (1-p)^{N-K} \frac{1}{\beta(a, b)} p^{a-1} (1-p)^{b-1} dp \\
       &amp;= {N \choose K} \frac{\beta(K+a, N-K+b)}{\beta(a, b)} \\
       &amp;= {N \choose K} \frac{\Gamma(a+b)}{\Gamma(a) \Gamma(b)} \frac{\Gamma(K+a) \Gamma(N-K+b)}{\Gamma(N+a+b)}

\end{align*}\]</span></p>
<p>For certain values of <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span>, this will simplify much further, but not in general. Lets visualize this prior for <span class="math inline">\(N = 100\)</span>.</p>
<p><img src="figure/discrete-Jeffreys-1.png" title="plot of chunk discrete-Jeffreys" alt="plot of chunk discrete-Jeffreys" style="display: block; margin: auto;"></p>
<p>Whatever choice of <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> we make, creating the posterior from here is fairly straightforward; of course, this does not simplify in any nice ways like the <span class="math inline">\(Binomial\)</span> would.</p>
</div>
<div id="multivariate-hypergeometric" class="section level2">
<h2 class="hasAnchor">
<a href="#multivariate-hypergeometric" class="anchor"></a><span class="header-section-number">1.4</span> Multivariate Hypergeometric</h2>
<p>We will define the <span class="math inline">\(Multivariate\ Hypergeometric\)</span> distribution in the same fashion as before, except this time <span class="math inline">\(\mathbf{K}\)</span> and <span class="math inline">\(\mathbf{J}\)</span> are vectors.</p>
<p>Additionally, we need to find a prior <span class="math inline">\(\pi(\mathbf{K})\)</span>. Suppose there are <span class="math inline">\(c\)</span> categories; following the same steps as the simple 1-dimensional example, we have:</p>
<p><span class="math display">\[\begin{align*}
  \pi(\mathbf{K}) &amp;= \int_{0}^{1} {N \choose {\mathbf{K}_1, ..., \mathbf{K}_c}} \prod_{i = 1}^c \mathbf{p}_i^{\mathbf{K}_i} \frac{1}{\beta(\mathbf{\alpha})} \prod_{i = 1}^c \mathbf{p}_i^{\mathbf{\alpha}_i - 1} d\mathbf{p} \\
    &amp;= {N \choose {\mathbf{K}_1, ..., \mathbf{K}_c}} \frac{\beta(\mathbf{K} + \mathbf{\alpha})}{\beta(\mathbf{\alpha})}

\end{align*}\]</span></p>
<p>From here, everything is fairly straightforward.</p>
</div>
<div id="correction-factor" class="section level2">
<h2 class="hasAnchor">
<a href="#correction-factor" class="anchor"></a><span class="header-section-number">1.5</span> Correction Factor</h2>
<p>Returning to the distribution we are trying to sample from, we had</p>
<p><span class="math display">\[ f(\theta, \mathbf{Y} = \mathbf{y}| \mathbf{X} = \mathbf{x}) \propto \pi(\theta | \mathbf{X} = \mathbf{x}) f(\mathbf{Y} = \mathbf{y} | \theta). \]</span> Whether using the <span class="math inline">\(Binomial\)</span> or <span class="math inline">\(Hypergeometric\)</span> distribution, in both cases this <span class="math inline">\(f(\mathbf{Y} = \mathbf{y} | \theta\)</span> term is essential and cannot be forgotten; without it, the sample ends up essentially not mattering.</p>
<p>To illustrate, let <span class="math inline">\(N = 10\)</span>. With such a small population, we can easily list every possible population. There are of course <span class="math inline">\(2^{10}\)</span> of them, since every subject in the population has two possible options. If we assume all possible populations are equally likely, we can visualize the probability distribution of <span class="math inline">\(K\)</span>, the number of <span class="math inline">\(1\)</span>’s in the population, with a simple bar plot.</p>
<p><img src="figure/correction-barplot-1.png" title="plot of chunk correction-barplot" alt="plot of chunk correction-barplot" style="display: block; margin: auto;"></p>
<p>This means that without any prior knowledge, or even an observed sample, we would expect <span class="math inline">\(K = 5\)</span> to be <span class="math inline">\(252\)</span> times more likely than <span class="math inline">\(K = 0\)</span> or <span class="math inline">\(K = 10\)</span>. This is clearly incorrect; if we know nothing about <span class="math inline">\(K\)</span>, then the distribution over <span class="math inline">\(K\)</span> should be flat. This term fixes that problem; in the binary case it is simply the reciprocal of the binomial coefficient <span class="math inline">\({N \choose K}\)</span>.</p>
<p>This correction factor carries over to the multiclass method, but it now uses the multinomial coefficient.</p>
</div>
</div>
<div id="samplers" class="section level1">
<h1 class="hasAnchor">
<a href="#samplers" class="anchor"></a><span class="header-section-number">2</span> Samplers</h1>
<p>Here we will outline straightforward approaches to synthesis for all four possible distributions. There are a few things worth discussing further.</p>
<p><strong>Should we make all populations include our sample?</strong> For example, if we observe a vector <span class="math inline">\(x = (1, 0, 0, 0, 1, 0)\)</span> and there are <span class="math inline">\(c = 2\)</span> classes, should <em>all</em> synthetic populations contain at least four <span class="math inline">\(0\)</span>’s and two <span class="math inline">\(1's\)</span>? If we are using the <span class="math inline">\(Hypergeometric\)</span> distribution, this actually happens automatically, but if we use the <span class="math inline">\(Binomial\)</span> distribution, we have the choice of enforing this criterion or not.</p>
<p>For the purpose of a more fair comparison, in this document we <em>will not</em> enforce that all populations contain the sample.</p>
<div id="binomial-1" class="section level2">
<h2 class="hasAnchor">
<a href="#binomial-1" class="anchor"></a><span class="header-section-number">2.1</span> Binomial</h2>
<p>Here is a very basic function that will jitter <span class="math inline">\(\mathbf{Y}\)</span>, and use the posterior in terms of <span class="math inline">\(p\)</span> to determine whether to accept or reject synthesized populations.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">popsim_binomial</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">obs</span>, <span class="va">N</span>, <span class="va">samples</span> <span class="op">=</span> <span class="fl">1000</span>, <span class="va">a</span> <span class="op">=</span> <span class="fl">0.5</span>, <span class="va">b</span> <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">logcorrection</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">N</span>, <span class="va">p</span><span class="op">)</span> <span class="op">{</span>
    <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Special.html">lchoose</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">N</span> <span class="op">*</span> <span class="va">p</span><span class="op">)</span>
  <span class="op">}</span>

  <span class="va">logprior</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">dbeta</a></span><span class="op">(</span><span class="va">p</span>, <span class="va">a</span>, <span class="va">b</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="op">}</span>

  <span class="va">logpost</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span>, <span class="va">J</span>, <span class="va">n</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">dbinom</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">n</span>, <span class="va">p</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="fu">logprior</span><span class="op">(</span><span class="va">p</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="op">+</span> <span class="fu">logcorrection</span><span class="op">(</span><span class="va">N</span>, <span class="va">p</span><span class="op">)</span>
  <span class="op">}</span>

  <span class="va">J</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span>
  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span>

  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="va">samples</span> <span class="op">+</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="va">N</span><span class="op">)</span>
  <span class="va">out</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, size <span class="op">=</span> <span class="va">N</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

  <span class="va">current_lp</span> <span class="op">&lt;-</span> <span class="fu">logpost</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">out</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span>, <span class="va">J</span>, <span class="va">n</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span>

  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="va">samples</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">current</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="op">]</span>
    <span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">proposal</span> <span class="op">&lt;-</span> <span class="va">current</span>
      <span class="va">proposal</span><span class="op">[</span><span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="op">!</span><span class="va">current</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">)</span>
      <span class="va">proposal_lp</span> <span class="op">&lt;-</span> <span class="fu">logpost</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">proposal</span><span class="op">)</span>, <span class="va">J</span>, <span class="va">n</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span>

      <span class="va">u</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
      <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">proposal_lp</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">u</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">proposal_lp</span> <span class="op">-</span> <span class="va">current_lp</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">current</span> <span class="op">&lt;-</span> <span class="va">proposal</span>
        <span class="va">current_lp</span> <span class="op">&lt;-</span> <span class="va">proposal_lp</span>
      <span class="op">}</span>
    <span class="op">}</span>
    <span class="va">out</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">current</span>
  <span class="op">}</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="multinomial-1" class="section level2">
<h2 class="hasAnchor">
<a href="#multinomial-1" class="anchor"></a><span class="header-section-number">2.2</span> Multinomial</h2>
<p>Not much has to change here. Depending how you code multiple categories, working with them can be quite difficult. The easiest set of categories to work with is <span class="math inline">\(\{1, 2, \dots, c\}\)</span>. This simplifies things a lot, mainly because it allows us to use <code>tabulate</code>, which speeds up the process considerably. The code below will fail if you pass it a sample with either of the following properties:</p>
<ul>
<li>A category denoted as <span class="math inline">\(0\)</span> (e.g. <code>obs = c(1, 0, 1, 0, 1, 2, 1, 2)</code>)
<ul>
<li>Either <em>missing</em> or <em>non-consecutive</em> categories (e.g. <code>obs = c(1, 3, 1, 1, 3, 1, 3, 3)</code>) – it will assume that there is a category 2, and just not observed in the sample, which likely isn’t what you want</li>
</ul>
</li>
</ul>
<p>This may be confusing because in the binary cases we <em>need</em> our samples to be <span class="math inline">\(\{0, 1\}\)</span>, but when working with more than two levels things can actually get quite complicated, and enforcing this simple criterion saves us a lot of headache. It is relatively simple to sandwich this method between two transformations to go from the original levels to positive integers, and then back to the original levels at the end.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">popsim_multinomial</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">obs</span>, <span class="va">N</span>, <span class="va">samples</span> <span class="op">=</span> <span class="fl">1000</span>, <span class="va">alpha</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">logcorrection</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">N</span>, <span class="va">K</span><span class="op">)</span> <span class="op">{</span>
    <span class="op">-</span><span class="fu"><a href="../../reference/Special.html">lmnchoose</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">K</span><span class="op">)</span>
  <span class="op">}</span>

  <span class="va">logprior</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span>, <span class="va">alpha</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/pkg/extraDistr/man/Dirichlet.html">ddirichlet</a></span><span class="op">(</span><span class="va">p</span>, <span class="va">alpha</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="op">}</span>

  <span class="va">logpost</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">K</span>, <span class="va">N</span>, <span class="va">J</span>, <span class="va">n</span>, <span class="va">alpha</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">p</span> <span class="op">&lt;-</span> <span class="va">K</span> <span class="op">/</span> <span class="va">N</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/Multinom.html">dmultinom</a></span><span class="op">(</span><span class="va">J</span>, prob <span class="op">=</span> <span class="va">p</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="fu">logprior</span><span class="op">(</span><span class="va">p</span>, <span class="va">alpha</span><span class="op">)</span> <span class="op">+</span> <span class="fu">logcorrection</span><span class="op">(</span><span class="va">N</span>, <span class="va">K</span><span class="op">)</span>
  <span class="op">}</span>

  <span class="va">J</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tabulate.html">tabulate</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span>
  <span class="va">uniq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span><span class="op">)</span>
  <span class="va">classes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">uniq</span><span class="op">)</span>
  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span>

  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="va">samples</span> <span class="op">+</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="va">N</span><span class="op">)</span>
  <span class="va">out</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">obs</span>, length.out <span class="op">=</span> <span class="va">N</span><span class="op">)</span>

  <span class="va">current_lp</span> <span class="op">&lt;-</span> <span class="fu">logpost</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tabulate.html">tabulate</a></span><span class="op">(</span><span class="va">out</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>, nbins <span class="op">=</span> <span class="va">classes</span><span class="op">)</span>, <span class="va">N</span>, <span class="va">J</span>, <span class="va">n</span>, <span class="va">alpha</span><span class="op">)</span>

  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="va">samples</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">current</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="op">]</span>
    <span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">proposal</span> <span class="op">&lt;-</span> <span class="va">current</span>
      <span class="va">proposal</span><span class="op">[</span><span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">uniq</span><span class="op">[</span><span class="op">-</span><span class="va">proposal</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span>, <span class="fl">1</span><span class="op">)</span>
      <span class="va">proposal_lp</span> <span class="op">&lt;-</span> <span class="fu">logpost</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tabulate.html">tabulate</a></span><span class="op">(</span><span class="va">proposal</span>, nbins <span class="op">=</span> <span class="va">classes</span><span class="op">)</span>, <span class="va">N</span>, <span class="va">J</span>, <span class="va">n</span>, <span class="va">alpha</span><span class="op">)</span>

      <span class="va">u</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
      <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">proposal_lp</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">u</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">proposal_lp</span> <span class="op">-</span> <span class="va">current_lp</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">current</span> <span class="op">&lt;-</span> <span class="va">proposal</span>
        <span class="va">current_lp</span> <span class="op">&lt;-</span> <span class="va">proposal_lp</span>
      <span class="op">}</span>
    <span class="op">}</span>
    <span class="va">out</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">current</span>
  <span class="op">}</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="hypergeometric-1" class="section level2">
<h2 class="hasAnchor">
<a href="#hypergeometric-1" class="anchor"></a><span class="header-section-number">2.3</span> Hypergeometric</h2>
<p>Here, we do the same thing we did for the <span class="math inline">\(Binomial\)</span> case, but instead use the posterior in terms of <span class="math inline">\(K\)</span> to determine whether to accept or reject synthesized populations.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">popsim_hypergeometric</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">obs</span>, <span class="va">N</span>, <span class="va">samples</span> <span class="op">=</span> <span class="fl">1000</span>, <span class="va">a</span> <span class="op">=</span> <span class="fl">0.5</span>, <span class="va">b</span> <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">logcorrection</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">N</span>, <span class="va">K</span><span class="op">)</span> <span class="op">{</span>
    <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Special.html">lchoose</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">K</span><span class="op">)</span>
  <span class="op">}</span>

  <span class="va">logprior</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">K</span>, <span class="va">N</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/Special.html">lchoose</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">K</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html">lbeta</a></span><span class="op">(</span><span class="va">K</span> <span class="op">+</span> <span class="va">a</span>, <span class="va">N</span> <span class="op">-</span> <span class="va">K</span> <span class="op">+</span> <span class="va">b</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html">lbeta</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span>
  <span class="op">}</span>

  <span class="va">logpost</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">K</span>, <span class="va">N</span>, <span class="va">J</span>, <span class="va">n</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/Hypergeometric.html">dhyper</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">K</span>, <span class="va">N</span> <span class="op">-</span> <span class="va">K</span>, <span class="va">n</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="fu">logprior</span><span class="op">(</span><span class="va">K</span>, <span class="va">N</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="op">+</span> <span class="fu">logcorrection</span><span class="op">(</span><span class="va">N</span>, <span class="va">K</span><span class="op">)</span>
  <span class="op">}</span>

  <span class="va">J</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span>
  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span>

  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="va">samples</span> <span class="op">+</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="va">N</span><span class="op">)</span>
  <span class="va">out</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, size <span class="op">=</span> <span class="va">N</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

  <span class="va">current_lp</span> <span class="op">&lt;-</span> <span class="fu">logpost</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">out</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span>, <span class="va">N</span>, <span class="va">J</span>, <span class="va">n</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span>

  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="va">samples</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">current</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="op">]</span>
    <span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">proposal</span> <span class="op">&lt;-</span> <span class="va">current</span>
      <span class="va">proposal</span><span class="op">[</span><span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="op">!</span><span class="va">current</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">)</span>
      <span class="va">proposal_lp</span> <span class="op">&lt;-</span> <span class="fu">logpost</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">proposal</span><span class="op">)</span>, <span class="va">N</span>, <span class="va">J</span>, <span class="va">n</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span>

      <span class="va">u</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
      <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">proposal_lp</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">u</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">proposal_lp</span> <span class="op">-</span> <span class="va">current_lp</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">current</span> <span class="op">&lt;-</span> <span class="va">proposal</span>
        <span class="va">current_lp</span> <span class="op">&lt;-</span> <span class="va">proposal_lp</span>
      <span class="op">}</span>
    <span class="op">}</span>
    <span class="va">out</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">current</span>
  <span class="op">}</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="multivariate-hypergeometric-1" class="section level2">
<h2 class="hasAnchor">
<a href="#multivariate-hypergeometric-1" class="anchor"></a><span class="header-section-number">2.4</span> Multivariate Hypergeometric</h2>
<p>This is also pretty straightforward; however, we do have to follow the rules we outlined for the <span class="math inline">\(Multinomial\)</span> method. The only difference between this an the <span class="math inline">\(Multinomial\)</span> method is that we use the posterior with respect to <span class="math inline">\(K\)</span> that accounts for sampling without replacement.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">popsim_mvhypergeometric</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">obs</span>, <span class="va">N</span>, <span class="va">samples</span> <span class="op">=</span> <span class="fl">1000</span>, <span class="va">alpha</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">logcorrection</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">N</span>, <span class="va">K</span><span class="op">)</span> <span class="op">{</span>
    <span class="op">-</span><span class="fu"><a href="../../reference/Special.html">lmnchoose</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">K</span><span class="op">)</span>
  <span class="op">}</span>

  <span class="va">logprior</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">K</span>, <span class="va">N</span>, <span class="va">alpha</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="../../reference/Special.html">lmnchoose</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">K</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../../reference/Special.html">lmvbeta</a></span><span class="op">(</span><span class="va">K</span> <span class="op">+</span> <span class="va">alpha</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="../../reference/Special.html">lmvbeta</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span>
  <span class="op">}</span>

  <span class="va">logpost</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">K</span>, <span class="va">N</span>, <span class="va">J</span>, <span class="va">n</span>, <span class="va">alpha</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/pkg/extraDistr/man/MultiHypergeometric.html">dmvhyper</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">K</span>, <span class="va">n</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="fu">logprior</span><span class="op">(</span><span class="va">K</span>, <span class="va">N</span>, <span class="va">alpha</span><span class="op">)</span> <span class="op">+</span> <span class="fu">logcorrection</span><span class="op">(</span><span class="va">N</span>, <span class="va">K</span><span class="op">)</span>
  <span class="op">}</span>

  <span class="va">J</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tabulate.html">tabulate</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span>
  <span class="va">uniq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span><span class="op">)</span>
  <span class="va">classes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">uniq</span><span class="op">)</span>
  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span>

  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="va">samples</span> <span class="op">+</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="va">N</span><span class="op">)</span>
  <span class="va">out</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">obs</span>, length.out <span class="op">=</span> <span class="va">N</span><span class="op">)</span>


  <span class="va">current_lp</span> <span class="op">&lt;-</span> <span class="fu">logpost</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tabulate.html">tabulate</a></span><span class="op">(</span><span class="va">out</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>, nbins <span class="op">=</span> <span class="va">classes</span><span class="op">)</span>, <span class="va">N</span>, <span class="va">J</span>, <span class="va">n</span>, <span class="va">alpha</span><span class="op">)</span>

  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="va">samples</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">current</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="op">]</span>
    <span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">proposal</span> <span class="op">&lt;-</span> <span class="va">current</span>
      <span class="va">proposal</span><span class="op">[</span><span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">uniq</span><span class="op">[</span><span class="op">-</span><span class="va">proposal</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span>, <span class="fl">1</span><span class="op">)</span>
      <span class="va">proposal_lp</span> <span class="op">&lt;-</span> <span class="fu">logpost</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tabulate.html">tabulate</a></span><span class="op">(</span><span class="va">proposal</span>, nbins <span class="op">=</span> <span class="va">classes</span><span class="op">)</span>, <span class="va">N</span>, <span class="va">J</span>, <span class="va">n</span>, <span class="va">alpha</span><span class="op">)</span>

      <span class="va">u</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
      <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">proposal_lp</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">u</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">proposal_lp</span> <span class="op">-</span> <span class="va">current_lp</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">current</span> <span class="op">&lt;-</span> <span class="va">proposal</span>
        <span class="va">current_lp</span> <span class="op">&lt;-</span> <span class="va">proposal_lp</span>
      <span class="op">}</span>
    <span class="op">}</span>
    <span class="va">out</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">current</span>
  <span class="op">}</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
</div>
<div id="comparisons" class="section level1">
<h1 class="hasAnchor">
<a href="#comparisons" class="anchor"></a><span class="header-section-number">3</span> Comparisons</h1>
<div id="setup" class="section level2">
<h2 class="hasAnchor">
<a href="#setup" class="anchor"></a><span class="header-section-number">3.1</span> Setup</h2>
<p>The first thing we need is our samples. We are going to use the following:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">obs_binary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>   <span class="co"># 60% / 40%</span>
<span class="va">obs_mc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span>       <span class="co"># 50% / 30% / 20%</span></code></pre></div>
</div>
<div id="location" class="section level2">
<h2 class="hasAnchor">
<a href="#location" class="anchor"></a><span class="header-section-number">3.2</span> Location</h2>
<p>For the binary methods, we can compare the posterior of how many <span class="math inline">\(1\)</span>’s are in the populations to see if the two methods give similar results. Here are the densities for N = 100 (left) and N = 1000 (right), both using 3 × 10<sup>4</sup> synthetic populations. The <span class="math inline">\(Binomial\)</span> method is represented in red, and the <span class="math inline">\(Hypergeometric\)</span> in blue.</p>
<p><img src="figure/denscomp_binary-1.png" title="plot of chunk denscomp_binary" alt="plot of chunk denscomp_binary" width="100%"></p>
<p>For the multiclass methods, we can instead look at a specific margin, e.g. the margin for category <span class="math inline">\(1\)</span>. Here are the densities for N = 100 (left) and N = 1000 (right), both using 5000 synthetic populations. The <span class="math inline">\(Multinomial\)</span> method is represented in red, and the <span class="math inline">\(Multivariate\ Hypergeometric\)</span> in blue.</p>
<p><img src="figure/denscomp_mc-1.png" title="plot of chunk denscomp_mc" alt="plot of chunk denscomp_mc" width="100%"></p>
</div>
<div id="time" class="section level2">
<h2 class="hasAnchor">
<a href="#time" class="anchor"></a><span class="header-section-number">3.3</span> Time</h2>
<p>Likewise, we can look at how long each method takes. None of these functions are optimized in any way; though they are written to be as similar as possible so the comparisons are as useful as possible. The total time is representative of creating 3 × 10<sup>4</sup> synthetic populations for the binary methods, and 5000 synthetic populations for the multiclass methods.</p>
<table class="table kable_wrapper table">
<caption>
Profile for Binomial, N = 100 (left) vs. N = 1000 (right)
</caption>
<tbody><tr>
<td>
<table class="table table">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Total %
</th>
<th style="text-align:right;">
Total Time
</th>
<th style="text-align:right;">
Self %
</th>
<th style="text-align:right;">
Self Time
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
popsim_binomial
</td>
<td style="text-align:right;">
80.24
</td>
<td style="text-align:right;">
86.48
</td>
<td style="text-align:right;">
26.76
</td>
<td style="text-align:right;">
28.84
</td>
</tr>
<tr>
<td style="text-align:left;">
logpost
</td>
<td style="text-align:right;">
53.48
</td>
<td style="text-align:right;">
57.64
</td>
<td style="text-align:right;">
22.08
</td>
<td style="text-align:right;">
23.80
</td>
</tr>
<tr>
<td style="text-align:left;">
dbinom
</td>
<td style="text-align:right;">
22.43
</td>
<td style="text-align:right;">
24.18
</td>
<td style="text-align:right;">
13.55
</td>
<td style="text-align:right;">
14.60
</td>
</tr>
<tr>
<td style="text-align:left;">
&lt;Other&gt;
</td>
<td style="text-align:right;">
19.76
</td>
<td style="text-align:right;">
21.30
</td>
<td style="text-align:right;">
19.76
</td>
<td style="text-align:right;">
21.30
</td>
</tr>
<tr>
<td style="text-align:left;">
logprior
</td>
<td style="text-align:right;">
8.96
</td>
<td style="text-align:right;">
9.66
</td>
<td style="text-align:right;">
8.96
</td>
<td style="text-align:right;">
9.66
</td>
</tr>
<tr>
<td style="text-align:left;">
mean
</td>
<td style="text-align:right;">
8.89
</td>
<td style="text-align:right;">
9.58
</td>
<td style="text-align:right;">
7.24
</td>
<td style="text-align:right;">
7.80
</td>
</tr>
<tr>
<td style="text-align:left;">
mean.default
</td>
<td style="text-align:right;">
1.65
</td>
<td style="text-align:right;">
1.78
</td>
<td style="text-align:right;">
1.65
</td>
<td style="text-align:right;">
1.78
</td>
</tr>
</tbody>
</table>
</td>
<td>
<table class="table table">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Total %
</th>
<th style="text-align:right;">
Total Time
</th>
<th style="text-align:right;">
Self %
</th>
<th style="text-align:right;">
Self Time
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
popsim_binomial
</td>
<td style="text-align:right;">
79.57
</td>
<td style="text-align:right;">
791.66
</td>
<td style="text-align:right;">
23.24
</td>
<td style="text-align:right;">
231.18
</td>
</tr>
<tr>
<td style="text-align:left;">
logpost
</td>
<td style="text-align:right;">
56.33
</td>
<td style="text-align:right;">
560.48
</td>
<td style="text-align:right;">
20.13
</td>
<td style="text-align:right;">
200.24
</td>
</tr>
<tr>
<td style="text-align:left;">
dbinom
</td>
<td style="text-align:right;">
27.58
</td>
<td style="text-align:right;">
274.38
</td>
<td style="text-align:right;">
12.70
</td>
<td style="text-align:right;">
126.34
</td>
</tr>
<tr>
<td style="text-align:left;">
&lt;Other&gt;
</td>
<td style="text-align:right;">
20.43
</td>
<td style="text-align:right;">
203.28
</td>
<td style="text-align:right;">
20.43
</td>
<td style="text-align:right;">
203.28
</td>
</tr>
<tr>
<td style="text-align:left;">
mean
</td>
<td style="text-align:right;">
14.88
</td>
<td style="text-align:right;">
148.04
</td>
<td style="text-align:right;">
13.23
</td>
<td style="text-align:right;">
131.62
</td>
</tr>
<tr>
<td style="text-align:left;">
logprior
</td>
<td style="text-align:right;">
8.63
</td>
<td style="text-align:right;">
85.86
</td>
<td style="text-align:right;">
8.63
</td>
<td style="text-align:right;">
85.86
</td>
</tr>
<tr>
<td style="text-align:left;">
mean.default
</td>
<td style="text-align:right;">
1.65
</td>
<td style="text-align:right;">
16.42
</td>
<td style="text-align:right;">
1.65
</td>
<td style="text-align:right;">
16.42
</td>
</tr>
</tbody>
</table>
</td>
</tr></tbody>
</table>
<table class="table kable_wrapper table">
<caption>
Profile for Hypergeometric, N = 100 (left) vs. N = 1000 (right)
</caption>
<tbody><tr>
<td>
<table class="table table">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Total %
</th>
<th style="text-align:right;">
Total Time
</th>
<th style="text-align:right;">
Self %
</th>
<th style="text-align:right;">
Self Time
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
popsim_hypergeometric
</td>
<td style="text-align:right;">
75.72
</td>
<td style="text-align:right;">
54.44
</td>
<td style="text-align:right;">
34.52
</td>
<td style="text-align:right;">
24.82
</td>
</tr>
<tr>
<td style="text-align:left;">
logpost
</td>
<td style="text-align:right;">
41.20
</td>
<td style="text-align:right;">
29.62
</td>
<td style="text-align:right;">
37.41
</td>
<td style="text-align:right;">
26.90
</td>
</tr>
<tr>
<td style="text-align:left;">
&lt;Other&gt;
</td>
<td style="text-align:right;">
24.28
</td>
<td style="text-align:right;">
17.46
</td>
<td style="text-align:right;">
24.28
</td>
<td style="text-align:right;">
17.46
</td>
</tr>
<tr>
<td style="text-align:left;">
dhyper
</td>
<td style="text-align:right;">
3.78
</td>
<td style="text-align:right;">
2.72
</td>
<td style="text-align:right;">
3.78
</td>
<td style="text-align:right;">
2.72
</td>
</tr>
</tbody>
</table>
</td>
<td>
<table class="table table">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Total %
</th>
<th style="text-align:right;">
Total Time
</th>
<th style="text-align:right;">
Self %
</th>
<th style="text-align:right;">
Self Time
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
popsim_hypergeometric
</td>
<td style="text-align:right;">
72.44
</td>
<td style="text-align:right;">
531.20
</td>
<td style="text-align:right;">
30.27
</td>
<td style="text-align:right;">
221.96
</td>
</tr>
<tr>
<td style="text-align:left;">
logpost
</td>
<td style="text-align:right;">
42.17
</td>
<td style="text-align:right;">
309.24
</td>
<td style="text-align:right;">
34.17
</td>
<td style="text-align:right;">
250.54
</td>
</tr>
<tr>
<td style="text-align:left;">
&lt;Other&gt;
</td>
<td style="text-align:right;">
27.56
</td>
<td style="text-align:right;">
202.10
</td>
<td style="text-align:right;">
27.56
</td>
<td style="text-align:right;">
202.10
</td>
</tr>
<tr>
<td style="text-align:left;">
dhyper
</td>
<td style="text-align:right;">
8.00
</td>
<td style="text-align:right;">
58.70
</td>
<td style="text-align:right;">
8.00
</td>
<td style="text-align:right;">
58.70
</td>
</tr>
</tbody>
</table>
</td>
</tr></tbody>
</table>
<table class="table kable_wrapper table">
<caption>
Profile for Multinomial, N = 100 (left) vs. N = 1000 (right)
</caption>
<tbody><tr>
<td>
<table class="table table">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Total %
</th>
<th style="text-align:right;">
Total Time
</th>
<th style="text-align:right;">
Self %
</th>
<th style="text-align:right;">
Self Time
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
popsim_multinomial
</td>
<td style="text-align:right;">
99.95
</td>
<td style="text-align:right;">
10024.52
</td>
<td style="text-align:right;">
99.23
</td>
<td style="text-align:right;">
9952.64
</td>
</tr>
<tr>
<td style="text-align:left;">
logpost
</td>
<td style="text-align:right;">
0.66
</td>
<td style="text-align:right;">
66.38
</td>
<td style="text-align:right;">
0.12
</td>
<td style="text-align:right;">
11.66
</td>
</tr>
<tr>
<td style="text-align:left;">
logcorrection
</td>
<td style="text-align:right;">
0.38
</td>
<td style="text-align:right;">
37.84
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
5.32
</td>
</tr>
<tr>
<td style="text-align:left;">
lmnchoose
</td>
<td style="text-align:right;">
0.32
</td>
<td style="text-align:right;">
32.52
</td>
<td style="text-align:right;">
0.04
</td>
<td style="text-align:right;">
4.02
</td>
</tr>
<tr>
<td style="text-align:left;">
sapply
</td>
<td style="text-align:right;">
0.28
</td>
<td style="text-align:right;">
28.50
</td>
<td style="text-align:right;">
0.10
</td>
<td style="text-align:right;">
10.02
</td>
</tr>
<tr>
<td style="text-align:left;">
logprior
</td>
<td style="text-align:right;">
0.13
</td>
<td style="text-align:right;">
13.12
</td>
<td style="text-align:right;">
0.04
</td>
<td style="text-align:right;">
4.08
</td>
</tr>
<tr>
<td style="text-align:left;">
simplify2array
</td>
<td style="text-align:right;">
0.10
</td>
<td style="text-align:right;">
9.76
</td>
<td style="text-align:right;">
0.06
</td>
<td style="text-align:right;">
5.68
</td>
</tr>
<tr>
<td style="text-align:left;">
ddirichlet
</td>
<td style="text-align:right;">
0.09
</td>
<td style="text-align:right;">
9.04
</td>
<td style="text-align:right;">
0.09
</td>
<td style="text-align:right;">
8.92
</td>
</tr>
<tr>
<td style="text-align:left;">
lapply
</td>
<td style="text-align:right;">
0.08
</td>
<td style="text-align:right;">
8.30
</td>
<td style="text-align:right;">
0.07
</td>
<td style="text-align:right;">
6.96
</td>
</tr>
<tr>
<td style="text-align:left;">
sample
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
5.50
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
4.76
</td>
</tr>
</tbody>
</table>
</td>
<td>
<table class="table table">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Total %
</th>
<th style="text-align:right;">
Total Time
</th>
<th style="text-align:right;">
Self %
</th>
<th style="text-align:right;">
Self Time
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
popsim_multinomial
</td>
<td style="text-align:right;">
95.16
</td>
<td style="text-align:right;">
1081.04
</td>
<td style="text-align:right;">
8.25
</td>
<td style="text-align:right;">
93.70
</td>
</tr>
<tr>
<td style="text-align:left;">
logpost
</td>
<td style="text-align:right;">
83.24
</td>
<td style="text-align:right;">
945.64
</td>
<td style="text-align:right;">
9.06
</td>
<td style="text-align:right;">
102.90
</td>
</tr>
<tr>
<td style="text-align:left;">
logcorrection
</td>
<td style="text-align:right;">
57.59
</td>
<td style="text-align:right;">
654.22
</td>
<td style="text-align:right;">
19.04
</td>
<td style="text-align:right;">
216.32
</td>
</tr>
<tr>
<td style="text-align:left;">
lmnchoose
</td>
<td style="text-align:right;">
38.54
</td>
<td style="text-align:right;">
437.90
</td>
<td style="text-align:right;">
3.57
</td>
<td style="text-align:right;">
40.52
</td>
</tr>
<tr>
<td style="text-align:left;">
sapply
</td>
<td style="text-align:right;">
34.98
</td>
<td style="text-align:right;">
397.38
</td>
<td style="text-align:right;">
6.47
</td>
<td style="text-align:right;">
73.52
</td>
</tr>
<tr>
<td style="text-align:left;">
lapply
</td>
<td style="text-align:right;">
21.62
</td>
<td style="text-align:right;">
245.58
</td>
<td style="text-align:right;">
20.10
</td>
<td style="text-align:right;">
228.36
</td>
</tr>
<tr>
<td style="text-align:left;">
logprior
</td>
<td style="text-align:right;">
10.45
</td>
<td style="text-align:right;">
118.68
</td>
<td style="text-align:right;">
3.09
</td>
<td style="text-align:right;">
35.08
</td>
</tr>
<tr>
<td style="text-align:left;">
ddirichlet
</td>
<td style="text-align:right;">
7.36
</td>
<td style="text-align:right;">
83.60
</td>
<td style="text-align:right;">
7.21
</td>
<td style="text-align:right;">
81.94
</td>
</tr>
<tr>
<td style="text-align:left;">
simplify2array
</td>
<td style="text-align:right;">
6.50
</td>
<td style="text-align:right;">
73.84
</td>
<td style="text-align:right;">
3.82
</td>
<td style="text-align:right;">
43.44
</td>
</tr>
<tr>
<td style="text-align:left;">
&lt;Other&gt;
</td>
<td style="text-align:right;">
4.84
</td>
<td style="text-align:right;">
55.04
</td>
<td style="text-align:right;">
4.84
</td>
<td style="text-align:right;">
55.04
</td>
</tr>
</tbody>
</table>
</td>
</tr></tbody>
</table>
<table class="table kable_wrapper table">
<caption>
Profile for Multivariate Hypergeometric, N = 100 (left) vs. N = 1000 (right)
</caption>
<tbody><tr>
<td>
<table class="table table">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Total %
</th>
<th style="text-align:right;">
Total Time
</th>
<th style="text-align:right;">
Self %
</th>
<th style="text-align:right;">
Self Time
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
popsim_mvhypergeometric
</td>
<td style="text-align:right;">
94.58
</td>
<td style="text-align:right;">
104.62
</td>
<td style="text-align:right;">
8.35
</td>
<td style="text-align:right;">
9.24
</td>
</tr>
<tr>
<td style="text-align:left;">
logpost
</td>
<td style="text-align:right;">
81.96
</td>
<td style="text-align:right;">
90.66
</td>
<td style="text-align:right;">
6.64
</td>
<td style="text-align:right;">
7.34
</td>
</tr>
<tr>
<td style="text-align:left;">
lmnchoose
</td>
<td style="text-align:right;">
49.39
</td>
<td style="text-align:right;">
54.64
</td>
<td style="text-align:right;">
6.89
</td>
<td style="text-align:right;">
7.62
</td>
</tr>
<tr>
<td style="text-align:left;">
sapply
</td>
<td style="text-align:right;">
42.51
</td>
<td style="text-align:right;">
47.02
</td>
<td style="text-align:right;">
14.97
</td>
<td style="text-align:right;">
16.56
</td>
</tr>
<tr>
<td style="text-align:left;">
logprior
</td>
<td style="text-align:right;">
33.70
</td>
<td style="text-align:right;">
37.28
</td>
<td style="text-align:right;">
7.23
</td>
<td style="text-align:right;">
8.00
</td>
</tr>
<tr>
<td style="text-align:left;">
logcorrection
</td>
<td style="text-align:right;">
28.02
</td>
<td style="text-align:right;">
31.00
</td>
<td style="text-align:right;">
3.98
</td>
<td style="text-align:right;">
4.40
</td>
</tr>
<tr>
<td style="text-align:left;">
simplify2array
</td>
<td style="text-align:right;">
14.23
</td>
<td style="text-align:right;">
15.74
</td>
<td style="text-align:right;">
7.97
</td>
<td style="text-align:right;">
8.82
</td>
</tr>
<tr>
<td style="text-align:left;">
dmvhyper
</td>
<td style="text-align:right;">
13.60
</td>
<td style="text-align:right;">
15.04
</td>
<td style="text-align:right;">
12.33
</td>
<td style="text-align:right;">
13.64
</td>
</tr>
<tr>
<td style="text-align:left;">
lapply
</td>
<td style="text-align:right;">
12.51
</td>
<td style="text-align:right;">
13.84
</td>
<td style="text-align:right;">
10.34
</td>
<td style="text-align:right;">
11.44
</td>
</tr>
<tr>
<td style="text-align:left;">
unique
</td>
<td style="text-align:right;">
6.26
</td>
<td style="text-align:right;">
6.92
</td>
<td style="text-align:right;">
4.99
</td>
<td style="text-align:right;">
5.52
</td>
</tr>
</tbody>
</table>
</td>
<td>
<table class="table table">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Total %
</th>
<th style="text-align:right;">
Total Time
</th>
<th style="text-align:right;">
Self %
</th>
<th style="text-align:right;">
Self Time
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
popsim_mvhypergeometric
</td>
<td style="text-align:right;">
96.90
</td>
<td style="text-align:right;">
1665.80
</td>
<td style="text-align:right;">
4.48
</td>
<td style="text-align:right;">
77.02
</td>
</tr>
<tr>
<td style="text-align:left;">
logpost
</td>
<td style="text-align:right;">
89.95
</td>
<td style="text-align:right;">
1546.32
</td>
<td style="text-align:right;">
3.60
</td>
<td style="text-align:right;">
61.90
</td>
</tr>
<tr>
<td style="text-align:left;">
lmnchoose
</td>
<td style="text-align:right;">
49.52
</td>
<td style="text-align:right;">
851.36
</td>
<td style="text-align:right;">
4.53
</td>
<td style="text-align:right;">
77.90
</td>
</tr>
<tr>
<td style="text-align:left;">
sapply
</td>
<td style="text-align:right;">
44.99
</td>
<td style="text-align:right;">
773.46
</td>
<td style="text-align:right;">
8.21
</td>
<td style="text-align:right;">
141.20
</td>
</tr>
<tr>
<td style="text-align:left;">
logprior
</td>
<td style="text-align:right;">
40.34
</td>
<td style="text-align:right;">
693.40
</td>
<td style="text-align:right;">
14.33
</td>
<td style="text-align:right;">
246.40
</td>
</tr>
<tr>
<td style="text-align:left;">
logcorrection
</td>
<td style="text-align:right;">
36.64
</td>
<td style="text-align:right;">
629.94
</td>
<td style="text-align:right;">
12.43
</td>
<td style="text-align:right;">
213.64
</td>
</tr>
<tr>
<td style="text-align:left;">
lapply
</td>
<td style="text-align:right;">
27.95
</td>
<td style="text-align:right;">
480.46
</td>
<td style="text-align:right;">
25.91
</td>
<td style="text-align:right;">
445.34
</td>
</tr>
<tr>
<td style="text-align:left;">
dmvhyper
</td>
<td style="text-align:right;">
9.37
</td>
<td style="text-align:right;">
161.08
</td>
<td style="text-align:right;">
6.91
</td>
<td style="text-align:right;">
118.72
</td>
</tr>
<tr>
<td style="text-align:left;">
simplify2array
</td>
<td style="text-align:right;">
8.32
</td>
<td style="text-align:right;">
143.10
</td>
<td style="text-align:right;">
4.72
</td>
<td style="text-align:right;">
81.08
</td>
</tr>
<tr>
<td style="text-align:left;">
unique
</td>
<td style="text-align:right;">
3.61
</td>
<td style="text-align:right;">
62.02
</td>
<td style="text-align:right;">
2.77
</td>
<td style="text-align:right;">
47.56
</td>
</tr>
</tbody>
</table>
</td>
</tr></tbody>
</table>
</div>
<div id="coverage" class="section level2">
<h2 class="hasAnchor">
<a href="#coverage" class="anchor"></a><span class="header-section-number">3.4</span> Coverage</h2>
<p>We can also consider the empirical coverage rates of credible intervals. We will only include the binary methods here, because the multiclass methods take far too long using the simple formulations above. They can be optimized further, of course; for large <span class="math inline">\(N\)</span> it can be beneficial to update the table during the iterations instead of recalculating it. We haven’t done so here because we wanted the most simple formulations. For these coverage rates, we will only use <span class="math inline">\(N = 100,\ n = 10\)</span>, and we create 100 synthetic populations for each of the 1000 samples per value of <span class="math inline">\(K\)</span>.</p>
<p>Below we see the empirical coverage rates for equal-tailed credible intervals capturing the <em>true</em> <span class="math inline">\(K\)</span>, the number of <span class="math inline">\(1\)</span>’s in the population. Both methods do quite well with K close to <span class="math inline">\(0.5 * N\)</span>; however, the <span class="math inline">\(Binomial\)</span> approximation does quite poorly compared to the <span class="math inline">\(Hypergeometric\)</span> method as we approach either tail.</p>
<table class="table table">
<thead>
<tr>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="1">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Method
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="15">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
K
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
3
</th>
<th style="text-align:right;">
10
</th>
<th style="text-align:right;">
17
</th>
<th style="text-align:right;">
23
</th>
<th style="text-align:right;">
30
</th>
<th style="text-align:right;">
37
</th>
<th style="text-align:right;">
43
</th>
<th style="text-align:right;">
50
</th>
<th style="text-align:right;">
57
</th>
<th style="text-align:right;">
63
</th>
<th style="text-align:right;">
70
</th>
<th style="text-align:right;">
77
</th>
<th style="text-align:right;">
83
</th>
<th style="text-align:right;">
90
</th>
<th style="text-align:right;">
97
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Binomial
</td>
<td style="text-align:right;">
21.2
</td>
<td style="text-align:right;">
61.0
</td>
<td style="text-align:right;">
80.6
</td>
<td style="text-align:right;">
88.0
</td>
<td style="text-align:right;">
88.0
</td>
<td style="text-align:right;">
90.6
</td>
<td style="text-align:right;">
89.2
</td>
<td style="text-align:right;">
89.2
</td>
<td style="text-align:right;">
88.1
</td>
<td style="text-align:right;">
88.1
</td>
<td style="text-align:right;">
86.1
</td>
<td style="text-align:right;">
84.8
</td>
<td style="text-align:right;">
79.7
</td>
<td style="text-align:right;">
60.2
</td>
<td style="text-align:right;">
23.2
</td>
</tr>
<tr>
<td style="text-align:left;">
Hypergeometric
</td>
<td style="text-align:right;">
95.9
</td>
<td style="text-align:right;">
88.9
</td>
<td style="text-align:right;">
83.9
</td>
<td style="text-align:right;">
87.1
</td>
<td style="text-align:right;">
87.5
</td>
<td style="text-align:right;">
88.6
</td>
<td style="text-align:right;">
88.5
</td>
<td style="text-align:right;">
87.0
</td>
<td style="text-align:right;">
86.3
</td>
<td style="text-align:right;">
87.0
</td>
<td style="text-align:right;">
83.4
</td>
<td style="text-align:right;">
83.4
</td>
<td style="text-align:right;">
82.6
</td>
<td style="text-align:right;">
86.8
</td>
<td style="text-align:right;">
95.1
</td>
</tr>
</tbody>
</table>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Christopher Grubb.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
