<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to Population Synthesis • lemur.pack</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Introduction to Population Synthesis">
<meta property="og:description" content="lemur.pack">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">lemur.pack</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../articles/lemur-pack.html">Get started</a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/articles/binary-1d-example.html">Binary 1-d Example</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/test.html">Testing</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ctgrubb/lemur.pack/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="binary-1d-example_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to Population Synthesis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ctgrubb/lemur.pack/blob/master/vignettes/articles/binary-1d-example.Rmd"><code>vignettes/articles/binary-1d-example.Rmd</code></a></small>
      <div class="hidden name"><code>binary-1d-example.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/">kableExtra</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">proftools</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span></code></pre></div>
<p>This vignette explains synthetic population sampling for the simplest case, where each individual is defined by one <span class="math inline">\(\mathbf{\{0, 1\}}\)</span> variable. The only piece of information used to inform what the population looks like is a simple random sample of size <span class="math inline">\(n\)</span>, which can be thought of as an <span class="math inline">\(n\)</span>-vector <span class="math inline">\(\mathbf{x}\)</span>, which is a realization of <span class="math inline">\(\mathbf{X}\)</span>. Our goal is to synthesize numerous realizations of the population <span class="math inline">\(\mathbf{Y}\)</span> with size <span class="math inline">\(N\)</span>. A realization of the population is denoted <span class="math inline">\(\mathbf{y}\)</span>, and we will assume that <span class="math inline">\(N\)</span> is known.</p>
<div id="theory" class="section level1">
<h1 class="hasAnchor">
<a href="#theory" class="anchor"></a>Theory</h1>
<p>For a population <span class="math inline">\(\mathbf{Y}\)</span>, sample <span class="math inline">\(\mathbf{X}\)</span>, and parameter set <span class="math inline">\(\theta\)</span>, we can use Bayes’ theorem to get the distribution for <span class="math inline">\(\mathbf{Y}\)</span>, conditioned on our observed sample, <span class="math inline">\(\mathbf{x}\)</span>.</p>
<p><span class="math display">\[\begin{align*}
  f(\theta, \mathbf{Y} = \mathbf{y}| \mathbf{X} = \mathbf{x}) &amp;= \frac{ f(\mathbf{X} = \mathbf{x} | \theta, \mathbf{Y} = \mathbf{y}) f(\theta, \mathbf{Y} = \mathbf{y}) }{ f(\mathbf{X} = \mathbf{x}) } \\
    &amp;\propto f(\mathbf{X} = \mathbf{x} | \theta) f(\mathbf{Y} = \mathbf{y} | \theta) \pi(\theta) \\
    &amp;\propto \pi(\theta | \mathbf{X} = \mathbf{x}) f(\mathbf{Y} = \mathbf{y} | \theta)
\end{align*}\]</span></p>
<p>For our simple case, this is actually quite simple, however we do have to make a few decisions:</p>
<ul>
<li>What is the distribution of <span class="math inline">\(f(\mathbf{X} = \mathbf{x} | \theta)\)</span>?</li>
<li>What prior <span class="math inline">\(\pi(\theta)\)</span> should we use?</li>
</ul>
<p>In regards to the first question, we have two options; we can either use a hypergeometric distribution and respect the fact that the populations are finite, or we can use a binomial distribution and pretend they are infinite. As the desired population size increases, the difference between these two approaches diminishes.</p>
<p>The first question must be answered before the second, since the population parameter is different depending which distribution you choose. For a binomial distribution, we must have a prior distribution on <span class="math inline">\(p\)</span>, the probability of being a <span class="math inline">\(1\)</span>, and for a hypergeometric distribution, we need a prior distribution on <span class="math inline">\(K\)</span>, the number of <span class="math inline">\(1\)</span>’s in the population.</p>
<div id="hypergeometric" class="section level2">
<h2 class="hasAnchor">
<a href="#hypergeometric" class="anchor"></a>Hypergeometric</h2>
<p>The common parameterization of the hypergeometric distribution can make this rather confusing. Instead of working with that, lets make our own.</p>
<p>Let <span class="math inline">\(f(\mathbf{Y}, K, \mathbf{X}, J)\)</span> denote the discrete Hypergeometric probability function, where:</p>
<ul>
<li>
<span class="math inline">\(\mathbf{Y}\)</span> is the population (i.e., the vector of <span class="math inline">\(\{0, 1\}\)</span> with length <span class="math inline">\(N\)</span>)</li>
<li>
<span class="math inline">\(K\)</span> is the number of successes (<span class="math inline">\(1\)</span>’s) in the population <span class="math inline">\(\mathbf{Y}\)</span>
</li>
<li>
<span class="math inline">\(\mathbf{X}\)</span> is the sample, with length <span class="math inline">\(n\)</span>
</li>
<li>
<span class="math inline">\(J\)</span> is the number of successes (<span class="math inline">\(1\)</span>’s) in the sample <span class="math inline">\(\mathbf{X}\)</span>
</li>
</ul>
<p>Now, we can apply the above theory to our specific distribution, and we get</p>
<p><span class="math display">\[\begin{align*}
  f(\mathbf{Y} = \mathbf{y}, \mathbf{K} | \mathbf{X} = \mathbf{x}, J) &amp;= \frac{ f(\mathbf{X} = \mathbf{x}, J | \mathbf{Y} = \mathbf{y}, K) f(\mathbf{Y} = \mathbf{y}, K) }{ f(\mathbf{X} = \mathbf{x}, J) } \\
                                 &amp;\propto f(\mathbf{X} = \mathbf{x}, J | K ) f(\mathbf{Y} = \mathbf{y} | K) \pi(K) \\
                                 &amp;\propto \pi(K | \mathbf{X} = \mathbf{x}, J) f(\mathbf{Y} = \mathbf{y} | K)
\end{align*}\]</span></p>
<p>We also need to choose <span class="math inline">\(\pi(K)\)</span>, the prior on the number of successes in the population. If we were working with instead a parameter <span class="math inline">\(p\)</span> denoting the probability of success or failure, we would likely want to use some version of the conjugate prior, <span class="math inline">\(Beta(a, b)\)</span>.</p>
<p>From Jeffreys (1946, 1961), the induced prior on <span class="math inline">\(K\)</span> can be found by constructing a hierarchical prior of the form</p>
<p><span class="math display">\[ Binom(K | p) Beta(p | a, b) \]</span></p>
<p>and then marginalizing to find <span class="math inline">\(\pi(K)\)</span>. Thus,</p>
<p><span class="math display">\[\begin{align*}
\pi(K) &amp;= \int_{0}^{1} {N \choose K} p^K (1-p)^{N-K} \frac{1}{\beta(a, b)} p^{a-1} (1-p)^{b-1} dp \\
       &amp;= {N \choose K} \frac{\beta(K+a, N-K+b)}{\beta(a, b)} \\
       &amp;= {N \choose K} \frac{\Gamma(a+b)}{\Gamma(a) \Gamma(b)} \frac{\Gamma(K+a) \Gamma(N-K+b)}{\Gamma(N+a+b)}

\end{align*}\]</span></p>
<p>For certain values of <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span>, this will simplify much further. Lets visualize this prior for <span class="math inline">\(N = 100\)</span>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">piKf</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">K</span>, <span class="va">N</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/Special.html">choose</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">K</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html">beta</a></span><span class="op">(</span><span class="va">K</span> <span class="op">+</span> <span class="va">a</span>, <span class="va">N</span> <span class="op">-</span> <span class="va">K</span> <span class="op">+</span> <span class="va">b</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html">beta</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span><span class="op">}</span>
<span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">100</span>
<span class="va">K</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">piK1</span> <span class="op">&lt;-</span> <span class="fu">piKf</span><span class="op">(</span><span class="va">K</span>, <span class="va">N</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span>
<span class="va">piK2</span> <span class="op">&lt;-</span> <span class="fu">piKf</span><span class="op">(</span><span class="va">K</span>, <span class="va">N</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>
<span class="va">piK3</span> <span class="op">&lt;-</span> <span class="fu">piKf</span><span class="op">(</span><span class="va">K</span>, <span class="va">N</span>, <span class="fl">2</span>, <span class="fl">0.5</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">K</span>, <span class="va">piK1</span>, ylab <span class="op">=</span> <span class="st">"p(K)"</span>, pch <span class="op">=</span> <span class="st">" "</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">K</span>, <span class="va">piK1</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">K</span>, <span class="va">piK2</span>, col <span class="op">=</span> <span class="st">"darkgreen"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">K</span>, <span class="va">piK3</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a = b = 0.5"</span>, <span class="st">"a = b = 1"</span>, <span class="st">"a = 2, b = 0.5"</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"darkgreen"</span>, <span class="st">"red"</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="figure/discrete-Jeffreys-1.png" style="display: block; margin: auto;"></p>
<p>Whatever choice of <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> we make, creating the posterior from here is fairly straightforward. For the hypergeometric case, this of course does not simplify in any nice ways; however, if we assume the population is distributed binomial, the conjugate beta prior will yield a beta posterior.</p>
</div>
<div id="binomial" class="section level2">
<h2 class="hasAnchor">
<a href="#binomial" class="anchor"></a>Binomial</h2>
<p>Things are much more easier if we drop the hypergeometric in favor of the binomial. If we apply the above theory to the binomial instead, we get</p>
<p><span class="math display">\[\begin{align*}
  f(\mathbf{Y} = \mathbf{y}, \mathbf{p} | \mathbf{X} = \mathbf{x}) &amp;= \frac{ f(\mathbf{X} = \mathbf{x} | \mathbf{Y} = \mathbf{y}, p) f(\mathbf{Y} = \mathbf{y}, p) }{ f(\mathbf{X} = \mathbf{x}) } \\
                                 &amp;\propto f(\mathbf{X} = \mathbf{x} | p ) f(\mathbf{Y} = \mathbf{y} | p) \pi(p) \\
                                 &amp;\propto \pi(p | \mathbf{X} = \mathbf{x}) f(\mathbf{Y} = \mathbf{y} | p)
\end{align*}\]</span></p>
<p>Using the conjugate <span class="math inline">\(Beta(a, b)\)</span> prior gives us the normal <span class="math inline">\(Beta(K+a, N-K+b)\)</span> posterior. There is a slight complication here. Typically when we are trying to learn <span class="math inline">\(p\)</span>, it is in a setting where <span class="math inline">\(p\)</span> will never exactly evaluate to either <span class="math inline">\(0\)</span> or <span class="math inline">\(1\)</span>. However, in our case we are going to calculate <span class="math inline">\(p\)</span> from a jittered <span class="math inline">\(Y\)</span>. If the mean of the observed <span class="math inline">\(x\)</span> is <span class="math inline">\(0\)</span> or <span class="math inline">\(1\)</span>, there is the possibility that our population will be completely <span class="math inline">\(0\)</span> or <span class="math inline">\(1\)</span>. If we used an improper (but commonly used) <span class="math inline">\(a = b = 1/2\)</span> <span class="math inline">\(Beta\)</span> prior, our posterior will also be improper and thus, our sampler won’t work. In the real world, it seems unlikely that we would encounter this problem, but it is worth being aware of. Also worth pointing out is that the hypergeometric solution does not have the same issue, as the hierarchical prior, with <span class="math inline">\(p\)</span> marginalized out, is always proper.</p>
</div>
<div id="correction-factor" class="section level2">
<h2 class="hasAnchor">
<a href="#correction-factor" class="anchor"></a>Correction Factor</h2>
<p>Returning to the distribution we are trying to sample from, we had</p>
<p><span class="math display">\[ f(\theta, \mathbf{Y} = \mathbf{y}| \mathbf{X} = \mathbf{x}) \propto \pi(\theta | \mathbf{X} = \mathbf{x}) f(\mathbf{Y} = \mathbf{y} | \theta). \]</span> Whether using the binomial or hypergeometric distribution, in both cases this term is essential and cannot be forgotten. This term is essential and without it, the sample ends up essentially not mattering.</p>
<p>To illustrate, let <span class="math inline">\(N = 10\)</span>. With such a small population, we can easily list every possible population. There are of course <span class="math inline">\(2^{10}\)</span> of them, since every subject in the population has two possible options. If we assume all possible populations are equally likely, we can visualize the probability distribution of <span class="math inline">\(K\)</span>, the number of <span class="math inline">\(1\)</span>’s in the population, with a simple bar plot.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">10</span>
<span class="va">K</span> <span class="op">&lt;-</span> <span class="fl">0</span><span class="op">:</span><span class="fl">10</span>
<span class="va">nCk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html">choose</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">K</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span><span class="op">(</span><span class="va">nCk</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">nCk</span><span class="op">)</span>, names.arg <span class="op">=</span> <span class="va">K</span>, xlab <span class="op">=</span> <span class="st">"K"</span>, ylab <span class="op">=</span> <span class="st">"Probability"</span><span class="op">)</span></code></pre></div>
<p><img src="figure/correction-barplot-1.png" style="display: block; margin: auto;"></p>
<p>This means that without any prior knowledge, or even an observed sample, we would expect <span class="math inline">\(K = 5\)</span> to be <span class="math inline">\(252\)</span> times more likely than <span class="math inline">\(K = 0\)</span> or <span class="math inline">\(K = 10\)</span>. This is clearly incorrect; if we know nothing about <span class="math inline">\(K\)</span>, then the distribution over <span class="math inline">\(K\)</span> should be flat.</p>
</div>
</div>
<div id="creating-a-sampler" class="section level1">
<h1 class="hasAnchor">
<a href="#creating-a-sampler" class="anchor"></a>Creating a Sampler</h1>
<p>As we will illustrate, there are a number of different ways to synthesize populations for this problem.</p>
<div id="setup" class="section level2">
<h2 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h2>
<p>The first thing we need is our sample. For starters lets fix the sample size at <span class="math inline">\(n = 10\)</span>, and synthesize populations of size <span class="math inline">\(N = 100\)</span>. Lets work with a sample that has a 40%/60% split of classes.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">10</span>
<span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">100</span>
<span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></code></pre></div>
</div>
<div id="which-space-to-synthesize-in" class="section level2">
<h2 class="hasAnchor">
<a href="#which-space-to-synthesize-in" class="anchor"></a>Which Space to Synthesize in?</h2>
<p>We have a couple options as far as how exactly we go about synthesizing these populations. One option (and I think the most straightforward) is to work in <span class="math inline">\(K\)</span> space.</p>
<div id="k-space" class="section level3">
<h3 class="hasAnchor">
<a href="#k-space" class="anchor"></a>K Space</h3>
<p>Here is a very basic function that will jitter <span class="math inline">\(\mathbf{Y}\)</span>, and use the posterior in terms of <span class="math inline">\(K\)</span> to determine whether to accept or reject synthesized populations.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">popsim_K</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">obs</span>, <span class="va">N</span>, <span class="va">samples</span> <span class="op">=</span> <span class="fl">1000</span>, <span class="va">a</span> <span class="op">=</span> <span class="fl">0.5</span>, <span class="va">b</span> <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">logcorrection</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">N</span>, <span class="va">K</span><span class="op">)</span> <span class="op">{</span>
    <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Special.html">lchoose</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">K</span><span class="op">)</span>
  <span class="op">}</span>

  <span class="va">logprior</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">K</span>, <span class="va">N</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/Special.html">lchoose</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">K</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html">lbeta</a></span><span class="op">(</span><span class="va">K</span> <span class="op">+</span> <span class="va">a</span>, <span class="va">N</span> <span class="op">-</span> <span class="va">K</span> <span class="op">+</span> <span class="va">b</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html">lbeta</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span>
  <span class="op">}</span>

  <span class="va">logpost</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">K</span>, <span class="va">N</span>, <span class="va">J</span>, <span class="va">n</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/Hypergeometric.html">dhyper</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">K</span>, <span class="va">N</span> <span class="op">-</span> <span class="va">K</span>, <span class="va">n</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="fu">logprior</span><span class="op">(</span><span class="va">K</span>, <span class="va">N</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="op">+</span> <span class="fu">logcorrection</span><span class="op">(</span><span class="va">N</span>, <span class="va">K</span><span class="op">)</span>
  <span class="op">}</span>

  <span class="va">J</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span>
  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span>

  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="va">samples</span> <span class="op">+</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="va">N</span><span class="op">)</span>
  <span class="va">out</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, size <span class="op">=</span> <span class="va">N</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

  <span class="va">current_lp</span> <span class="op">&lt;-</span> <span class="fu">logpost</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">out</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span>, <span class="va">N</span>, <span class="va">J</span>, <span class="va">n</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span>

  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="va">samples</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">current</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="op">]</span>
    <span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">proposal</span> <span class="op">&lt;-</span> <span class="va">current</span>
      <span class="va">proposal</span><span class="op">[</span><span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="op">!</span><span class="va">current</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">)</span>
      <span class="va">proposal_lp</span> <span class="op">&lt;-</span> <span class="fu">logpost</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">proposal</span><span class="op">)</span>, <span class="va">N</span>, <span class="va">J</span>, <span class="va">n</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span>

      <span class="va">u</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
      <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">proposal_lp</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">u</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">proposal_lp</span> <span class="op">-</span> <span class="va">current_lp</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">current</span> <span class="op">&lt;-</span> <span class="va">proposal</span>
        <span class="va">current_lp</span> <span class="op">&lt;-</span> <span class="va">proposal_lp</span>
      <span class="op">}</span>
    <span class="op">}</span>
    <span class="va">out</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">current</span>
  <span class="op">}</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="p-space" class="section level3">
<h3 class="hasAnchor">
<a href="#p-space" class="anchor"></a>P Space</h3>
<p>We can do the exact same thing, using <span class="math inline">\(p\)</span> instead of <span class="math inline">\(K\)</span>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">popsim_p</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">obs</span>, <span class="va">N</span>, <span class="va">samples</span> <span class="op">=</span> <span class="fl">1000</span>, <span class="va">a</span> <span class="op">=</span> <span class="fl">0.5</span>, <span class="va">b</span> <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">logcorrection</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">N</span>, <span class="va">p</span><span class="op">)</span> <span class="op">{</span>
    <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Special.html">lchoose</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">N</span> <span class="op">*</span> <span class="va">p</span><span class="op">)</span>
  <span class="op">}</span>

  <span class="va">logprior</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">dbeta</a></span><span class="op">(</span><span class="va">p</span>, <span class="va">a</span>, <span class="va">b</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="op">}</span>

  <span class="va">logpost</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span>, <span class="va">J</span>, <span class="va">n</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">dbinom</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">n</span>, <span class="va">p</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="fu">logprior</span><span class="op">(</span><span class="va">p</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="op">+</span> <span class="fu">logcorrection</span><span class="op">(</span><span class="va">N</span>, <span class="va">p</span><span class="op">)</span>
  <span class="op">}</span>

  <span class="va">J</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span>
  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span>

  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="va">samples</span> <span class="op">+</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="va">N</span><span class="op">)</span>
  <span class="va">out</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, size <span class="op">=</span> <span class="va">N</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

  <span class="va">current_lp</span> <span class="op">&lt;-</span> <span class="fu">logpost</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">out</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span>, <span class="va">J</span>, <span class="va">n</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span>

  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="va">samples</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">current</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="op">]</span>
    <span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">proposal</span> <span class="op">&lt;-</span> <span class="va">current</span>
      <span class="va">proposal</span><span class="op">[</span><span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="op">!</span><span class="va">current</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">)</span>
      <span class="va">proposal_lp</span> <span class="op">&lt;-</span> <span class="fu">logpost</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">proposal</span><span class="op">)</span>, <span class="va">J</span>, <span class="va">n</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span>

      <span class="va">u</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
      <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">proposal_lp</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">u</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">proposal_lp</span> <span class="op">-</span> <span class="va">current_lp</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">current</span> <span class="op">&lt;-</span> <span class="va">proposal</span>
        <span class="va">current_lp</span> <span class="op">&lt;-</span> <span class="va">proposal_lp</span>
      <span class="op">}</span>
    <span class="op">}</span>
    <span class="va">out</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">current</span>
  <span class="op">}</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
</div>
</div>
<div id="comparisons" class="section level1">
<h1 class="hasAnchor">
<a href="#comparisons" class="anchor"></a>Comparisons</h1>
<div id="location" class="section level2">
<h2 class="hasAnchor">
<a href="#location" class="anchor"></a>Location</h2>
<p>We can compare the location of the posterior in terms of <span class="math inline">\(K\)</span> to see if the two methods give similar results.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">popsim_K_prof</span> <span class="op">&lt;-</span> <span class="fu">profileExpr</span><span class="op">(</span><span class="va">popsim_K_test</span> <span class="op">&lt;-</span> <span class="fu">popsim_K</span><span class="op">(</span><span class="va">obs</span>, <span class="va">N</span>, <span class="va">comp_iters</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>
<span class="va">popsim_p_prof</span> <span class="op">&lt;-</span> <span class="fu">profileExpr</span><span class="op">(</span><span class="va">popsim_p_test</span> <span class="op">&lt;-</span> <span class="fu">popsim_p</span><span class="op">(</span><span class="va">obs</span>, <span class="va">N</span>, <span class="va">comp_iters</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">popsim_K_test</span><span class="op">)</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"blue"</span>, main <span class="op">=</span> <span class="st">""</span>, xlab <span class="op">=</span> <span class="st">"K or N * p"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">popsim_p_test</span><span class="op">)</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></code></pre></div>
<p><img src="figure/denscomp-1.png" style="display: block; margin: auto;"></p>
</div>
<div id="time" class="section level2">
<h2 class="hasAnchor">
<a href="#time" class="anchor"></a>Time</h2>
<p>Likewise, we can look at how long each method takes. Neither of these functions are optimized in any way; though they are written to be as similar as possible so the comparison is potentially useful.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">prof_K</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="fu">flatProfile</span><span class="op">(</span><span class="va">popsim_K_prof</span>, byTotal <span class="op">=</span> <span class="cn">TRUE</span>, GC <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, <span class="op">]</span>
<span class="va">prof_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="fu">flatProfile</span><span class="op">(</span><span class="va">popsim_p_prof</span>, byTotal <span class="op">=</span> <span class="cn">TRUE</span>, GC <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, <span class="op">]</span></code></pre></div>
<p>As we can see, the method using <span class="math inline">\(K\)</span> is quite a bit faster.</p>
<table class="table kable_wrapper table"><tbody><tr>
<td>
<table class="table table">
<caption>
Profiling for K Method
</caption>
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Total %
</th>
<th style="text-align:right;">
Total Time
</th>
<th style="text-align:right;">
Self %
</th>
<th style="text-align:right;">
Self Time
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
popsim_K
</td>
<td style="text-align:right;">
76.19
</td>
<td style="text-align:right;">
153.76
</td>
<td style="text-align:right;">
34.64
</td>
<td style="text-align:right;">
69.90
</td>
</tr>
<tr>
<td style="text-align:left;">
logpost
</td>
<td style="text-align:right;">
41.54
</td>
<td style="text-align:right;">
83.82
</td>
<td style="text-align:right;">
37.63
</td>
<td style="text-align:right;">
75.94
</td>
</tr>
<tr>
<td style="text-align:left;">
&lt;Other&gt;
</td>
<td style="text-align:right;">
23.81
</td>
<td style="text-align:right;">
48.04
</td>
<td style="text-align:right;">
23.81
</td>
<td style="text-align:right;">
48.04
</td>
</tr>
<tr>
<td style="text-align:left;">
dhyper
</td>
<td style="text-align:right;">
3.90
</td>
<td style="text-align:right;">
7.88
</td>
<td style="text-align:right;">
3.90
</td>
<td style="text-align:right;">
7.88
</td>
</tr>
<tr>
<td style="text-align:left;">
cmp
</td>
<td style="text-align:right;">
0.02
</td>
<td style="text-align:right;">
0.04
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
</tr>
<tr>
<td style="text-align:left;">
cmpCall
</td>
<td style="text-align:right;">
0.02
</td>
<td style="text-align:right;">
0.04
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
</tr>
</tbody>
</table>
</td>
<td>
<table class="table table">
<caption>
Profiling for p Method
</caption>
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Total %
</th>
<th style="text-align:right;">
Total Time
</th>
<th style="text-align:right;">
Self %
</th>
<th style="text-align:right;">
Self Time
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
popsim_p
</td>
<td style="text-align:right;">
80.54
</td>
<td style="text-align:right;">
214.60
</td>
<td style="text-align:right;">
25.79
</td>
<td style="text-align:right;">
68.72
</td>
</tr>
<tr>
<td style="text-align:left;">
logpost
</td>
<td style="text-align:right;">
54.73
</td>
<td style="text-align:right;">
145.84
</td>
<td style="text-align:right;">
21.87
</td>
<td style="text-align:right;">
58.28
</td>
</tr>
<tr>
<td style="text-align:left;">
dbinom
</td>
<td style="text-align:right;">
23.61
</td>
<td style="text-align:right;">
62.90
</td>
<td style="text-align:right;">
13.85
</td>
<td style="text-align:right;">
36.90
</td>
</tr>
<tr>
<td style="text-align:left;">
&lt;Other&gt;
</td>
<td style="text-align:right;">
19.46
</td>
<td style="text-align:right;">
51.86
</td>
<td style="text-align:right;">
19.46
</td>
<td style="text-align:right;">
51.86
</td>
</tr>
<tr>
<td style="text-align:left;">
mean
</td>
<td style="text-align:right;">
9.76
</td>
<td style="text-align:right;">
26.00
</td>
<td style="text-align:right;">
7.93
</td>
<td style="text-align:right;">
21.14
</td>
</tr>
<tr>
<td style="text-align:left;">
logprior
</td>
<td style="text-align:right;">
9.25
</td>
<td style="text-align:right;">
24.66
</td>
<td style="text-align:right;">
9.25
</td>
<td style="text-align:right;">
24.66
</td>
</tr>
</tbody>
</table>
</td>
</tr></tbody></table>
</div>
<div id="coverage" class="section level2">
<h2 class="hasAnchor">
<a href="#coverage" class="anchor"></a>Coverage</h2>
<p>We can also consider the empirical coverage rates of credible intervals. Since the method based on <span class="math inline">\(p\)</span> can have issues with improper priors, we will use <span class="math inline">\(a = b = 1\)</span>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cov_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="fl">2</span>, ncol <span class="op">=</span> <span class="va">cov_points</span>,
                  dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
                    Method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"K Space"</span>, <span class="st">"p Space"</span><span class="op">)</span>,
                    K <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">N</span>, length.out <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">cov_points</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">cov_points</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
                  <span class="op">)</span>
<span class="op">)</span>

<span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">cov_points</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">K</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">cov_mat</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="va">k</span><span class="op">]</span>
  <span class="va">pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">K</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">N</span> <span class="op">-</span> <span class="va">K</span><span class="op">)</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">cov_iters</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">pop</span>, size <span class="op">=</span> <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
    <span class="va">popsim_K_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="fu">popsim_K</span><span class="op">(</span><span class="va">sample</span>, <span class="va">N</span>, <span class="va">cov_samples</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span>
    <span class="va">popsim_p_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="fu">popsim_p</span><span class="op">(</span><span class="va">sample</span>, <span class="va">N</span>, <span class="va">cov_samples</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span>
    <span class="kw">if</span><span class="op">(</span><span class="va">popsim_K_res</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="va">K</span> <span class="op">&amp;</span> <span class="va">K</span> <span class="op">&lt;=</span> <span class="va">popsim_K_res</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">cov_mat</span><span class="op">[</span><span class="fl">1</span>, <span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">cov_mat</span><span class="op">[</span><span class="fl">1</span>, <span class="va">k</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span>
    <span class="op">}</span>
    <span class="kw">if</span><span class="op">(</span><span class="va">popsim_p_res</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="va">K</span> <span class="op">&amp;</span> <span class="va">K</span> <span class="op">&lt;=</span> <span class="va">popsim_p_res</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">cov_mat</span><span class="op">[</span><span class="fl">2</span>, <span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">cov_mat</span><span class="op">[</span><span class="fl">2</span>, <span class="va">k</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span>
    <span class="op">}</span>
  <span class="op">}</span>
<span class="op">}</span>

<span class="va">cov_mat</span> <span class="op">&lt;-</span> <span class="va">cov_mat</span> <span class="op">/</span> <span class="va">cov_iters</span> <span class="op">*</span> <span class="fl">100</span></code></pre></div>
<p>Below we see the empirical rates of capturing the <em>true</em> <span class="math inline">\(K\)</span>, the number of <span class="math inline">\(1\)</span>’s in the population. Both methods do quite well, as expected.</p>
<table class="table table">
<thead>
<tr>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="1">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Method
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="15">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
K
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
3
</th>
<th style="text-align:right;">
10
</th>
<th style="text-align:right;">
17
</th>
<th style="text-align:right;">
23
</th>
<th style="text-align:right;">
30
</th>
<th style="text-align:right;">
37
</th>
<th style="text-align:right;">
43
</th>
<th style="text-align:right;">
50
</th>
<th style="text-align:right;">
57
</th>
<th style="text-align:right;">
63
</th>
<th style="text-align:right;">
70
</th>
<th style="text-align:right;">
77
</th>
<th style="text-align:right;">
83
</th>
<th style="text-align:right;">
90
</th>
<th style="text-align:right;">
97
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
K Space
</td>
<td style="text-align:right;">
91
</td>
<td style="text-align:right;">
94
</td>
<td style="text-align:right;">
91
</td>
<td style="text-align:right;">
94
</td>
<td style="text-align:right;">
91
</td>
<td style="text-align:right;">
92
</td>
<td style="text-align:right;">
92
</td>
<td style="text-align:right;">
95
</td>
<td style="text-align:right;">
88
</td>
<td style="text-align:right;">
85
</td>
<td style="text-align:right;">
92
</td>
<td style="text-align:right;">
91
</td>
<td style="text-align:right;">
87
</td>
<td style="text-align:right;">
95
</td>
<td style="text-align:right;">
91
</td>
</tr>
<tr>
<td style="text-align:left;">
p Space
</td>
<td style="text-align:right;">
93
</td>
<td style="text-align:right;">
94
</td>
<td style="text-align:right;">
91
</td>
<td style="text-align:right;">
94
</td>
<td style="text-align:right;">
91
</td>
<td style="text-align:right;">
93
</td>
<td style="text-align:right;">
95
</td>
<td style="text-align:right;">
95
</td>
<td style="text-align:right;">
91
</td>
<td style="text-align:right;">
91
</td>
<td style="text-align:right;">
92
</td>
<td style="text-align:right;">
93
</td>
<td style="text-align:right;">
87
</td>
<td style="text-align:right;">
95
</td>
<td style="text-align:right;">
88
</td>
</tr>
</tbody>
</table>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Christopher Grubb.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
