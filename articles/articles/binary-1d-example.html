<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to Population Synthesis • lemur.pack</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Introduction to Population Synthesis">
<meta property="og:description" content="lemur.pack">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">lemur.pack</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/articles/binary-1d-example.html">Introduction to Population Synthesis</a>
    </li>
    <li>
      <a href="../../articles/test.html">test</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ctgrubb/lemur.pack/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="binary-1d-example_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to Population Synthesis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ctgrubb/lemur.pack/blob/master/vignettes/articles/binary-1d-example.Rmd"><code>vignettes/articles/binary-1d-example.Rmd</code></a></small>
      <div class="hidden name"><code>binary-1d-example.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ctgrubb.github.io/lemur.pack">lemur.pack</a></span><span class="op">)</span></code></pre></div>
<p>This vignette explains synthetic population sampling for the simplest case, where each individual is defined by one <span class="math inline">\(\mathbf{\{0, 1\}}\)</span> variable. The only piece of information used to inform what the population looks like is a simple random sample of size <span class="math inline">\(n\)</span>, which can be thought of as an <span class="math inline">\(n\)</span>-vector <span class="math inline">\(\mathbf{x}\)</span>, which is a realization of <span class="math inline">\(\mathbf{X}\)</span>. Our goal is to synthesize numerous realizations of the population <span class="math inline">\(\mathbf{Y}\)</span> with size <span class="math inline">\(N\)</span>. A realization of the population is denoted <span class="math inline">\(\mathbf{y}\)</span>, and we will assume that <span class="math inline">\(N\)</span> is known.</p>
<div id="theory" class="section level1">
<h1 class="hasAnchor">
<a href="#theory" class="anchor"></a>Theory</h1>
<p>For a population <span class="math inline">\(\mathbf{Y}\)</span>, sample <span class="math inline">\(\mathbf{X}\)</span>, and parameter set <span class="math inline">\(\theta\)</span>, we can use Bayes’ theorem to get the distribution for <span class="math inline">\(\mathbf{Y}\)</span>, conditioned on our observed sample, <span class="math inline">\(\mathbf{x}\)</span>.</p>
<p><span class="math display">\[\begin{align*}
  f(\theta, \mathbf{Y} = \mathbf{y}| \mathbf{X} = \mathbf{x}) &amp;= \frac{ f(\mathbf{X} = \mathbf{x} | \theta, \mathbf{Y} = \mathbf{y}) f(\theta, \mathbf{Y} = \mathbf{y}) }{ f(\mathbf{X} = \mathbf{x}) } \\
    &amp;\propto f(\mathbf{X} = \mathbf{x} | \theta) f(\mathbf{Y} = \mathbf{y} | \theta) \pi(\theta) \\
    &amp;\propto \pi(\theta | \mathbf{X} = \mathbf{x}) f(\mathbf{Y} = \mathbf{y} | \theta)
\end{align*}\]</span></p>
<p>For our simple case, this is actually quite simple, however we do have to make a few decisions:</p>
<ul>
<li>What is the distribution of <span class="math inline">\(f(\mathbf{X} = \mathbf{x} | \theta)\)</span>?</li>
<li>What prior <span class="math inline">\(\pi(\theta)\)</span> should we use?</li>
</ul>
<p>In regards to the first question, we have two options; we can either use a hypergeometric distribution and respect the fact that the populations are finite, or we can use a binomial distribution and pretend they are infinite. As the desired population size increases, the difference between these two approaches diminishes.</p>
<p>The first question must be answered before the second, since the population parameter is different depending which distribution you choose. For a binomial distribution, we must have a prior distribution on <span class="math inline">\(p\)</span>, the probability of being a <span class="math inline">\(1\)</span>, and for a hypergeometric distribution, we need a prior distribution on <span class="math inline">\(K\)</span>, the number of <span class="math inline">\(1\)</span>’s in the population.</p>
<div id="hypergeometric" class="section level2">
<h2 class="hasAnchor">
<a href="#hypergeometric" class="anchor"></a>Hypergeometric</h2>
<p>The common parameterization of the hypergeometric distribution can make this rather confusing. Instead of working with that, lets make our own.</p>
<p>Let <span class="math inline">\(f(\mathbf{Y}, K, \mathbf{X}, J)\)</span> denote the discrete Hypergeometric probability function, where:</p>
<ul>
<li>
<span class="math inline">\(\mathbf{Y}\)</span> is the population (i.e., the vector of <span class="math inline">\(\{0, 1\}\)</span> with length <span class="math inline">\(N\)</span>)</li>
<li>
<span class="math inline">\(K\)</span> is the number of successes (<span class="math inline">\(1\)</span>’s) in the population <span class="math inline">\(\mathbf{Y}\)</span>
</li>
<li>
<span class="math inline">\(\mathbf{X}\)</span> is the sample, with length <span class="math inline">\(n\)</span>
</li>
<li>
<span class="math inline">\(J\)</span> is the number of successes (<span class="math inline">\(1\)</span>’s) in the sample <span class="math inline">\(\mathbf{X}\)</span>
</li>
</ul>
<p>Now, we can apply the above theory to our specific distribution</p>
<p><span class="math display">\[\begin{align*}
  f(\mathbf{Y} = \mathbf{y}, \mathbf{K} | \mathbf{X} = \mathbf{x}, J) &amp;= \frac{ f(\mathbf{X} = \mathbf{x}, J | \mathbf{Y} = \mathbf{y}, K) f(\mathbf{Y} = \mathbf{y}, K) }{ f(\mathbf{X} = \mathbf{x}, J) } \\
                                 &amp;\propto f(\mathbf{X} = \mathbf{x}, J | K ) f(\mathbf{Y} = \mathbf{y} | K) \pi(K) \\
                                 &amp;\propto \pi(K | \mathbf{X} = \mathbf{x}, J) f(\mathbf{Y} = \mathbf{y} | K)
\end{align*}\]</span></p>
<p>We also need to choose <span class="math inline">\(\pi(K)\)</span>, the prior on the number of successes in the population. If we were working with instead a parameter <span class="math inline">\(p\)</span> denoting the probability of success or failure, we would likely want to use some version of the conjugate prior, <span class="math inline">\(Beta(\alpha, \beta)\)</span>.</p>
<p>From Jeffreys (1946, 1961), the induced prior on <span class="math inline">\(K\)</span> can be found by constructing a hierarchical prior of the form</p>
<p><span class="math display">\[ Binom(K | p) Beta(p | \alpha, \beta) \]</span></p>
<p>and then marginalizing to find <span class="math inline">\(\pi(K)\)</span>. Thus,</p>
<p><span class="math display">\[\begin{align*}
\pi(K) &amp;= \int_{0}^{1} {N \choose K} p^K (1-p)^{N-K} \frac{1}{\pi} p^{\alpha-1} (1-p)^{\beta-1} \\
       &amp;= \frac{1}{\pi} \frac{\Gamma(K+\alpha)\Gamma(N-K+\beta)}
          {\Gamma(K+1) \Gamma(N-K+1)}
\end{align*}\]</span></p>
<p>If we use <span class="math inline">\(\alpha = \beta = 1/2\)</span>, we end up with the Jeffreys prior. Lets visualize this prior for <span class="math inline">\(N = 100\)</span>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">piKf</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">K</span>, <span class="va">N</span><span class="op">)</span> <span class="op">{</span><span class="fl">1</span> <span class="op">/</span> <span class="va">pi</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html">gamma</a></span><span class="op">(</span><span class="va">K</span> <span class="op">+</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html">gamma</a></span><span class="op">(</span><span class="va">N</span> <span class="op">-</span> <span class="va">K</span> <span class="op">+</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html">gamma</a></span><span class="op">(</span><span class="va">K</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html">gamma</a></span><span class="op">(</span><span class="va">N</span> <span class="op">-</span> <span class="va">K</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">}</span>
<span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">100</span>
<span class="va">K</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">piK</span> <span class="op">&lt;-</span> <span class="fu">piKf</span><span class="op">(</span><span class="va">K</span>, <span class="va">N</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">K</span>, <span class="va">piK</span>, ylab <span class="op">=</span> <span class="st">"p(K)"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">K</span>, <span class="va">piK</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="figure/discrete-Jeffreys-1.png" alt=""><p class="caption">plot of chunk discrete-Jeffreys</p>
</div>
<p>It is not a coincidence that this looks very similar to the shape of the Jeffreys prior on <span class="math inline">\(p\)</span>; this is essentially just a discrete version of the same thing. Note that if we instead use a flat prior on <span class="math inline">\(p\)</span> (i.e. <span class="math inline">\(\alpha = \beta = 1\)</span>), we induce a flat prior on <span class="math inline">\(K\)</span>.</p>
<p>Whatever choice of <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> we make, creating the posterior from here is fairly straightforward. For the hypergeometric case, this of course does not simplify in any nice ways; however, if we assume the population is distributed binomial, the conjugate beta prior will yield a beta posterior.</p>
</div>
<div id="binomial" class="section level2">
<h2 class="hasAnchor">
<a href="#binomial" class="anchor"></a>Binomial</h2>
</div>
<div id="correction-factor" class="section level2">
<h2 class="hasAnchor">
<a href="#correction-factor" class="anchor"></a>Correction Factor</h2>
<p>Returning to the distribution we are trying to sample from, we had</p>
<p><span class="math display">\[ f(\theta, \mathbf{Y} = \mathbf{y}| \mathbf{X} = \mathbf{x}) \propto \pi(\theta | \mathbf{X} = \mathbf{x}) f(\mathbf{Y} = \mathbf{y} | \theta). \]</span> Whether using the binomial or hypergeometric distribution, in both cases this term is essential and cannot be forgotten. This term is essential and without it, the sample ends up essentially not mattering.</p>
<p>To illustrate, let <span class="math inline">\(N = 10\)</span>. With such a small population, we can easily list every possible population. There are of course <span class="math inline">\(2^{10}\)</span> of them, since every subject in the population has two possible options. If we assume all possible populations are equally likely, we can visualize the probability distribution of <span class="math inline">\(K\)</span>, the number of <span class="math inline">\(1\)</span>’s in the population, with a simple bar plot.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">10</span>
<span class="va">K</span> <span class="op">&lt;-</span> <span class="fl">0</span><span class="op">:</span><span class="fl">10</span>
<span class="va">nCk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html">choose</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">K</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span><span class="op">(</span><span class="va">nCk</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">nCk</span><span class="op">)</span>, names.arg <span class="op">=</span> <span class="va">K</span>, xlab <span class="op">=</span> <span class="st">"K"</span>, ylab <span class="op">=</span> <span class="st">"Probability"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="figure/correction-barplot-1.png" alt=""><p class="caption">plot of chunk correction-barplot</p>
</div>
<p>This means that without any prior knowledge, or even an observed sample, we would expect <span class="math inline">\(K = 5\)</span> to be <span class="math inline">\(252\)</span> times more likely than <span class="math inline">\(K = 0\)</span> or <span class="math inline">\(K = 10\)</span>. This is clearly incorrect; if we know nothing about <span class="math inline">\(K\)</span>, then the distribution over <span class="math inline">\(K\)</span> should be flat.</p>
</div>
</div>
<div id="creating-a-sampler" class="section level1">
<h1 class="hasAnchor">
<a href="#creating-a-sampler" class="anchor"></a>Creating a Sampler</h1>
<p>As we will illustrate, there are a number of different ways to synthesize populations for this problem.</p>
<div id="setup" class="section level2">
<h2 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h2>
<p>The first thing we need is our sample. For starters lets fix the sample size at <span class="math inline">\(n = 10\)</span>, and synthesize populations of size <span class="math inline">\(N = 100\)</span>. Lets work with a sample that has a 40%/60% split of classes.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">10</span>
<span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">100</span>
<span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></code></pre></div>
</div>
<div id="which-space-to-synthesize-in" class="section level2">
<h2 class="hasAnchor">
<a href="#which-space-to-synthesize-in" class="anchor"></a>Which Space to Synthesize in?</h2>
<p>We have a couple options as far as how exactly we go about synthesizing these populations. One option (and I think the most straightforward) is to work in <span class="math inline">\(K\)</span> space.</p>
<div id="k-space" class="section level3">
<h3 class="hasAnchor">
<a href="#k-space" class="anchor"></a>K Space</h3>
<p>Here is a very basic function that will jitter <span class="math inline">\(\mathbf{Y}\)</span>, and use the posterior in terms of <span class="math inline">\(K\)</span> to determine whether to accept or reject synthesized populations.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">popsim_K</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">obs</span>, <span class="va">N</span>, <span class="va">samples</span> <span class="op">=</span> <span class="fl">1000</span>, <span class="va">a</span> <span class="op">=</span> <span class="fl">0.5</span>, <span class="va">b</span> <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">logcorrection</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">N</span>, <span class="va">K</span><span class="op">)</span> <span class="op">{</span>
    <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Special.html">lchoose</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">K</span><span class="op">)</span>
  <span class="op">}</span>
  
  <span class="va">logprior</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">K</span>, <span class="va">N</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="op">{</span>
    <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">pi</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html">lgamma</a></span><span class="op">(</span><span class="va">K</span> <span class="op">+</span> <span class="va">a</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html">lgamma</a></span><span class="op">(</span><span class="va">N</span> <span class="op">-</span> <span class="va">K</span> <span class="op">+</span> <span class="va">b</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html">lgamma</a></span><span class="op">(</span><span class="va">K</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html">lgamma</a></span><span class="op">(</span><span class="va">N</span> <span class="op">-</span> <span class="va">K</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>
  <span class="op">}</span>

  <span class="va">logpost</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">K</span>, <span class="va">N</span>, <span class="va">J</span>, <span class="va">n</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/Hypergeometric.html">dhyper</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">K</span>, <span class="va">N</span> <span class="op">-</span> <span class="va">K</span>, <span class="va">n</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="fu">logprior</span><span class="op">(</span><span class="va">K</span>, <span class="va">N</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="op">+</span> <span class="fu">logcorrection</span><span class="op">(</span><span class="va">N</span>, <span class="va">K</span><span class="op">)</span>
  <span class="op">}</span>
  
  <span class="va">J</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span>
  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span>
  
  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="va">samples</span> <span class="op">+</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="va">N</span><span class="op">)</span>
  <span class="va">out</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, size <span class="op">=</span> <span class="va">N</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  
  <span class="va">current_lp</span> <span class="op">&lt;-</span> <span class="fu">logpost</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">out</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span>, <span class="va">N</span>, <span class="va">J</span>, <span class="va">n</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span>
  
  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="va">samples</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">current</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="op">]</span>
    <span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">proposal</span> <span class="op">&lt;-</span> <span class="va">current</span>
      <span class="va">proposal</span><span class="op">[</span><span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="op">!</span><span class="va">current</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">)</span>
      <span class="va">proposal_lp</span> <span class="op">&lt;-</span> <span class="fu">logpost</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">proposal</span><span class="op">)</span>, <span class="va">N</span>, <span class="va">J</span>, <span class="va">n</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span>
      
      <span class="va">u</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
      <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">u</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">proposal_lp</span> <span class="op">-</span> <span class="va">current_lp</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">current</span> <span class="op">&lt;-</span> <span class="va">proposal</span>
        <span class="va">current_lp</span> <span class="op">&lt;-</span> <span class="va">proposal_lp</span>
      <span class="op">}</span>
    <span class="op">}</span>
    <span class="va">out</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">current</span>
  <span class="op">}</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
</div>
<div id="comparisons" class="section level2">
<h2 class="hasAnchor">
<a href="#comparisons" class="anchor"></a>Comparisons</h2>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">popsim_K_test</span> <span class="op">&lt;-</span> <span class="fu">popsim_K</span><span class="op">(</span><span class="va">obs</span>, <span class="va">N</span>, <span class="fl">1000</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">popsim_K_test</span><span class="op">)</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"blue"</span>, main <span class="op">=</span> <span class="st">""</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="figure/densities-1.png" alt=""><p class="caption">plot of chunk densities</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Christopher Grubb.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
