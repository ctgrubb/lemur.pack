<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Extending to Two Dimensions • lemur.pack</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Extending to Two Dimensions">
<meta property="og:description" content="lemur.pack">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">lemur.pack</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../articles/lemur-pack.html">Get started</a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/articles/binary-1d-example.html">Binary 1-d Example</a>
    </li>
    <li>
      <a href="../../articles/articles/binary-2d-example.html">Extending to 2-d</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/test.html">Testing</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ctgrubb/lemur.pack/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="binary-2d-example_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Extending to Two Dimensions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ctgrubb/lemur.pack/blob/master/vignettes/articles/binary-2d-example.Rmd"><code>vignettes/articles/binary-2d-example.Rmd</code></a></small>
      <div class="hidden name"><code>binary-2d-example.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ctgrubb.github.io/lemur.pack">lemur.pack</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/">kableExtra</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span></code></pre></div>
<p>This vignette extends  to two dimensions.</p>
<div id="theory" class="section level1">
<h1 class="hasAnchor">
<a href="#theory" class="anchor"></a>Theory</h1>
<p>Recall from the above article:</p>
<blockquote>
<p>For a population <span class="math inline">\(\mathbf{Y}\)</span>, sample <span class="math inline">\(\mathbf{X}\)</span>, and parameter set <span class="math inline">\(\theta\)</span>, we can use Bayes’ theorem to get the distribution for <span class="math inline">\(\mathbf{Y}\)</span>, conditioned on our observed sample, <span class="math inline">\(\mathbf{x}\)</span>.</p>
<p><span class="math display">\[\begin{align*}
f(\theta, \mathbf{Y} = \mathbf{y}| \mathbf{X} = \mathbf{x}) &amp;= \frac{ f(\mathbf{X} = \mathbf{x} | \theta, \mathbf{Y} = \mathbf{y}) f(\theta, \mathbf{Y} = \mathbf{y}) }{ f(\mathbf{X} = \mathbf{x}) } \\
&amp;\propto f(\mathbf{X} = \mathbf{x} | \theta) f(\mathbf{Y} = \mathbf{y} | \theta) \pi(\theta) \\
&amp;\propto \pi(\theta | \mathbf{X} = \mathbf{x}) f(\mathbf{Y} = \mathbf{y} | \theta)
\end{align*}\]</span></p>
</blockquote>
<p>Suppose <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> are now described by two binary <span class="math inline">\(\{0, 1\}\)</span> variables instead of just one. We have at least two options on how to handle this change.</p>
</div>
<div id="option-1-direct-extension" class="section level1">
<h1 class="hasAnchor">
<a href="#option-1-direct-extension" class="anchor"></a>Option 1: Direct Extension</h1>
<p>One option, which is very simple, is to use the multivariate hypergeometric distribution. Instead of having just two categories like the previous article, we can collapse our two variables into one varaible that would have four categories. Everything from the previous article regarding <span class="math inline">\(K\)</span> space will hold with very little modification. And since the multivariate hypergeometric converges to a multinomial distribution just as the hypergeometric converges to a binomial distribution, the method for working in <span class="math inline">\(p\)</span> space will also work. We simply need to:</p>
<ul>
<li>Use the multivariate hypergeometric distribution for <span class="math inline">\(f(\mathbf{X} = \mathbf{x} | \mathbf{K})\)</span> for <span class="math inline">\(K\)</span> method</li>
<li>Use the multinomial distribution for <span class="math inline">\(f(\mathbf{X} = \mathbf{x} | \mathbf{p})\)</span> for <span class="math inline">\(p\)</span> method</li>
<li>Change the priors; <span class="math inline">\(p\)</span> will now use a dirichlet prior and we can use a similar marginalized prior for <span class="math inline">\(K\)</span>
</li>
<li>Fix the correction factor</li>
</ul>
<div id="brief-outline-for-k-space" class="section level2">
<h2 class="hasAnchor">
<a href="#brief-outline-for-k-space" class="anchor"></a>Brief Outline for <span class="math inline">\(K\)</span> Space</h2>
<p>Note this will end up working <em>exactly</em> the same as if we had one variable with <span class="math inline">\(3\)</span> or more categories. We will definte the multivariate hypergeometric distribution in the same fashion as before, except this time <span class="math inline">\(\mathbf{K}\)</span> and <span class="math inline">\(\mathbf{J}\)</span> are vectors.</p>
<p>First, we need to find a prior <span class="math inline">\(\pi(\mathbf{K})\)</span>. Suppose there are <span class="math inline">\(c = 4\)</span> categories formed by crossing our two variables (this could be any number, we just want an index for <span class="math inline">\(\mathbf{K}\)</span>). Following the same steps as the simple 1-dimensional example, we have:</p>
<p><span class="math display">\[\begin{align*}
  \pi(\mathbf{K}) &amp;= \int_{0}^{1} {N \choose {\mathbf{K}_1, ..., \mathbf{K}_c}} \prod_{i = 1}^c \mathbf{p}_i^{\mathbf{K}_i} \frac{1}{\beta(\mathbf{\alpha})} \prod_{i = 1}^c \mathbf{p}_i^{\mathbf{\alpha}_i - 1} d\mathbf{p} \\
    &amp;= {N \choose {\mathbf{K}_1, ..., \mathbf{K}_c}} \frac{\beta(\mathbf{K} + \mathbf{\alpha})}{\beta(\mathbf{\alpha})}

\end{align*}\]</span></p>
<p>Now we can use this prior to build a sampler. Lets assume the sample is coming to us in a form like <code><a href="https://rdrr.io/r/base/c.html">c(1, 2, 3, 4, ...)</a></code>, instead of a matrix. It should be simple to go from <code><a href="https://rdrr.io/r/base/c.html">c(0, 0)</a></code> to 1, <code><a href="https://rdrr.io/r/base/c.html">c(0, 1)</a></code> to 2, etc., and vice-versa.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">popsim_K</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">obs</span>, <span class="va">N</span>, <span class="va">samples</span> <span class="op">=</span> <span class="fl">1000</span>, <span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">logcorrection</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">N</span>, <span class="va">K</span><span class="op">)</span> <span class="op">{</span>
    <span class="op">-</span><span class="fu"><a href="../../reference/Special.html">lmnchoose</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">K</span><span class="op">)</span>
  <span class="op">}</span>

  <span class="va">logprior</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">K</span>, <span class="va">N</span>, <span class="va">alpha</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="../../reference/Special.html">lmnchoose</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">K</span><span class="op">)</span> <span class="op">+</span> <span class="fu">lmnbeta</span><span class="op">(</span><span class="va">K</span> <span class="op">+</span> <span class="va">alpha</span><span class="op">)</span> <span class="op">-</span> <span class="fu">lmnbeta</span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span>
  <span class="op">}</span>

  <span class="va">logpost</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">K</span>, <span class="va">N</span>, <span class="va">obs</span>, <span class="va">n</span>, <span class="va">alpha</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu">dmvhyper</span><span class="op">(</span><span class="va">obs</span>, <span class="va">K</span>, <span class="va">n</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="fu">logprior</span><span class="op">(</span><span class="va">K</span>, <span class="va">N</span>, <span class="va">alpha</span><span class="op">)</span> <span class="op">+</span> <span class="fu">logcorrection</span><span class="op">(</span><span class="va">N</span>, <span class="va">K</span><span class="op">)</span>
  <span class="op">}</span>

  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span>

  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="va">samples</span> <span class="op">+</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="va">N</span><span class="op">)</span>
  <span class="va">out</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">obs</span>, length.out <span class="op">=</span> <span class="va">N</span><span class="op">)</span>

  <span class="va">current_lp</span> <span class="op">&lt;-</span> <span class="fu">logpost</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">out</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span><span class="op">)</span>, <span class="va">N</span>, <span class="va">J</span>, <span class="va">n</span>, <span class="va">alpha</span><span class="op">)</span>

  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="va">samples</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">current</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="op">]</span>
    <span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">proposal</span> <span class="op">&lt;-</span> <span class="va">current</span>
      <span class="va">proposal</span><span class="op">[</span><span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="va">proposal</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span>, <span class="fl">1</span><span class="op">)</span>
      <span class="va">proposal_lp</span> <span class="op">&lt;-</span> <span class="fu">logpost</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">out</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span><span class="op">)</span>, <span class="va">N</span>, <span class="va">J</span>, <span class="va">n</span>, <span class="va">alpha</span><span class="op">)</span>

      <span class="va">u</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
      <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">proposal_lp</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">u</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">proposal_lp</span> <span class="op">-</span> <span class="va">current_lp</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">current</span> <span class="op">&lt;-</span> <span class="va">proposal</span>
        <span class="va">current_lp</span> <span class="op">&lt;-</span> <span class="va">proposal_lp</span>
      <span class="op">}</span>
    <span class="op">}</span>
    <span class="va">out</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">current</span>
  <span class="op">}</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
</div>
<div id="option-2-using-conditionals" class="section level1">
<h1 class="hasAnchor">
<a href="#option-2-using-conditionals" class="anchor"></a>Option 2: Using Conditionals</h1>
<p>One alternative is to break <span class="math inline">\(f(\mathbf{X} = \mathbf{x} | \theta)\)</span> into <span class="math inline">\(f(\mathbf{X}_2 = \mathbf{x}_2 | \mathbf{X}_1 = \mathbf{x}_1, \theta) f(\mathbf{X}_1 = \mathbf{x}_1 | \theta)\)</span>. This makes it potentially easier to incorporate relationships into the model, if they are known to us. For example, maybe we know <span class="math inline">\(f(X_2 = 0 | X_1 = 0)\)</span> should be <span class="math inline">\(1\)</span>; i.e., if <span class="math inline">\(X_1 = 0\)</span>, then <span class="math inline">\(X_2 = 0\)</span>, always.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Christopher Grubb.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
